<?xml version="1.0" encoding="UTF-8"?>
<System AppServerName="" AutoConnectToEdit="T" CalendarTable="ZT070" DBCP="" DatabaseName="jdbc:derby://localhost/&lt;CURRENT>\db" DatabasePassword="XEAD" DatabaseUser="XEAD" DateFormat="jp11" DriverVMOptions="-Xms256m -Xmx256m" EditorUser="00000" EditorUserPassword="0000000000" ExchangeRateAnnualTable="ZT080" ExchangeRateMonthlyTable="ZT081" FormatVersion="1.2" HashFormat="" ImageFileFolder="&lt;CURRENT>\db\image" LoginScript="/////////////////////////////////////#EOL#// 前後日付算出（検索条件初期値用）//#EOL#/////////////////////////////////////#EOL#var today = session.getToday() + '';#EOL#var dateLastWeek = session.getOffsetDate(today, -7, 0);#EOL#var dateNextWeek = session.getOffsetDate(today, 7, 0);#EOL#var date3MonthsAgo = session.getOffsetDate(today, -91, 0);#EOL#var date2MonthsAgo = session.getOffsetDate(today, -61, 0);#EOL#var dateLastMonth = session.getOffsetDate(today, -30, 0);#EOL#var dateNextMonth = session.getOffsetDate(today, 30, 0);#EOL#var dateLastYear = session.getOffsetDate(today, -365, 0);#EOL#var currentFYear = session.getFYearOfDate(today);#EOL##EOL#//////////////////////////#EOL#// セッション属性の登録 //#EOL#//////////////////////////#EOL#session.setAttribute('Today', today);#EOL#session.setAttribute('DateLastWeek', dateLastWeek);#EOL#session.setAttribute('DateNextWeek', dateNextWeek);#EOL#session.setAttribute('Date3MonthsAgo', date3MonthsAgo);#EOL#session.setAttribute('Date2MonthsAgo', date2MonthsAgo);#EOL#session.setAttribute('DateLastMonth', dateLastMonth);#EOL#session.setAttribute('DateNextMonth', dateNextMonth);#EOL#session.setAttribute('DateLastYear', dateLastYear);#EOL#session.setAttribute('CurrentFYear', currentFYear);#EOL##EOL#session.setAttribute('PFormID', 0);" Name="ナントカ管理システム" NumberingTable="ZT030" OutputFolder="" ProxyIP="" ProxyPort="" Remarks="システム定義を新規作成するための初期値として、フォルダ全体をコピーしたうえでご利用ください。規定のシステム制御テーブルや、標準的な組織管理テーブルの定義情報が含まれています。また、下位のdbフォルダには、システムが起動するために必要な最小限のレコードを含むテーブルモジュール(注)が存在します。業務フローやデータモデル等については、このファイルと同じフォルダに置かれているSkeleton.xead を参照してください（閲覧・編集するためには無償のモデリングツール X-TEA Modeler が必要です）。#EOL##EOL#注：テーブルモジュールとは、create table文によって作り出された「実テーブル」のことです。この表現はX-TEA Editor上の「テーブル定義」ととくに区別するときに使われます。#EOL##EOL#◆利用条件#EOL#・本データの著作権および所有権はDBC社が有します#EOL#・本データを使用したことによって発生したいかなるトラブル、損害にも、著作者は一切の責任を負いません#EOL#・以上の点が了承・遵守される限りにおいて、本データを無償にてご利用できます。なお、商業的な再配布・転載等の際には、事前に御相談ください#EOL#" ScriptFunctions="//////////////////////////#EOL#// メッセージ表示用関数 //#EOL#//////////////////////////#EOL#function showMessage(message) {#EOL#&#x9;javax.swing.JOptionPane.showMessageDialog(null, message);#EOL#}" SessionDetailTable="ZT051" SessionTable="ZT050" SkipModuleCheck="F" SkipPreload="F" SmtpAdminEmail="" SmtpHost="" SmtpPassword="" SmtpPort="" SmtpUser="" SystemFont="Meiryo UI" TaxTable="ZT060" UserFilterValueTable="ZT021" UserTable="ZT020" UserVariantsTable="ZT040" VariantsTable="ZT010" Version="1.0.8" WelcomePageURL=""><Menu HelpURL="" ID="10" Name="マスター管理メニュー"><Option FunctionID="AF010" Index="00" OptionName=""/><Option FunctionID="AF020" Index="01" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="90" Name="システム管理メニュー"><Option FunctionID="ZF010" Index="00" OptionName=""/><Option FunctionID="ZF020" Index="01" OptionName=""/><Option FunctionID="ZF030" Index="02" OptionName=""/><Option FunctionID="ZF040" Index="03" OptionName=""/><Option FunctionID="ZF050" Index="05" OptionName=""/><Option FunctionID="ZF060" Index="10" OptionName=""/><Option FunctionID="ZF080" Index="12" OptionName=""/><Option FunctionID="ZF082" Index="13" OptionName=""/><Option FunctionID="ZF070" Index="11" OptionName=""/><Option FunctionID="ZFWEBTEST" Index="08" OptionName=""/><Option FunctionID="ZF900" Index="06" OptionName=""/></Menu><Menu CrossCheckersToBeLoaded="" FunctionsToBeLoaded="" HelpURL="" ID="20" Name="ナントカ管理メニュー"><Option FunctionID="PF0100" Index="00" OptionName=""/></Menu><Subsystem ID="A" Name="組織マスター管理" Remarks="門、従業員といった全社的な基本台帳とその管理機能を提供するサブシステム"/><Subsystem ID="Z" Name="システム管理" Remarks="システムへのログインや利用履歴、およびシステム変数等の基本的なシステム設定値を管理するためのサブシステム"/><Subsystem ID="P" Name="音声合成" Remarks=""/><Table ActiveWhere="" ID="AT010" Name="部門" RangeKey="" Remarks="部門定義を保持するためのテーブル" SubsystemID="A"><Field ID="CDBUMON" Name="部門Ｃ" Nullable="F" Order="0010" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXBUMON" Name="部門名" Nullable="F" Order="0020" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field ID="NRKANRISYA" Name="管理者№" Nullable="F" Order="0030" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Key Fields="CDBUMON" Type="PK"/><Refer Fields="TXKANJI" Order="0" OrderBy="" TableAlias="" ToKeyFields="" ToTable="AT020" WithKeyFields="AT010.NRKANRISYA"/><Field ID="TXTEKIYO" Name="摘要" Nullable="T" Order="0040" Remarks="" Size="300" Type="VARCHAR" TypeOptions="KANJI"/><Script EventP="BD" EventR="BR()" Function="" Name="削除チェック" Order="0000" Text="var rAT011 = instance.createTableOperator('Count', 'AT011');#EOL#rAT011.addKeyValue('CDBUMON',&#x9;AT010_CDBUMON.value);#EOL#if (rAT011.execute() > 0) {#EOL#&#x9;AT010_CDBUMON.error = 'この部門は部門階層テーブルで利用されているので、削除できません。';#EOL#}#EOL##EOL#var rAT011 = instance.createTableOperator('Count', 'AT011');#EOL#rAT011.addKeyValue('CDJYOUIBUMON',&#x9;AT010_CDBUMON.value);#EOL#if (rAT011.execute() > 0) {#EOL#&#x9;AT010_CDBUMON.error = 'この部門は部門階層テーブルの上位部門として参照されているため、削除できません。';#EOL#}#EOL##EOL#var rAT021 = instance.createTableOperator('Count', 'AT021');#EOL#rAT021.addKeyValue('CDBUMON',&#x9;AT010_CDBUMON.value);#EOL#if (rAT021.execute() > 0) {#EOL#&#x9;AT010_CDBUMON.error = 'この部門は従業員所属テーブルで利用されているので、削除できません。';#EOL#}#EOL#"/></Table><Table ActiveWhere="" ID="AT011" Name="部門階層" RangeKey="" Remarks="組織階層情報を保持するためのテーブル。部門毎に年月期間別の上位部門が定義される。" SubsystemID="A"><Field ID="CDBUMON" Name="部門Ｃ" Nullable="F" Order="0" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="DTHAKKOUNENGETSU" Name="発効年月" Nullable="F" Order="1" Remarks="" Size="6" Type="CHAR" TypeOptions="YMONTH"/><Field ID="CDJYOUIBUMON" Name="上位部門Ｃ" Nullable="F" Order="2" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="DTSIKKOUNENGETSU" Name="失効年月" Nullable="F" Order="3" Remarks="" Size="6" Type="CHAR" TypeOptions="YMONTH"/><Key Fields="CDBUMON;DTHAKKOUNENGETSU" Type="PK"/><Refer Fields="TXBUMON" Order="0010" TableAlias="AT010A1" ToKeyFields="" ToTable="AT010" WithKeyFields="AT011.CDBUMON"/><Refer Fields="TXBUMON" Order="0020" TableAlias="AT010A2" ToKeyFields="" ToTable="AT010" WithKeyFields="AT011.CDJYOUIBUMON"/><Script EventP="BC;BU" EventR="BR()" Name="失効年月のエラー検査" Order="0010" Text="if (AT011_DTSIKKOUNENGETSU.value != '' &amp;&amp; AT011_DTSIKKOUNENGETSU.value &lt;=  AT011_DTHAKKOUNENGETSU.value) {#EOL#&#x9;AT011_DTSIKKOUNENGETSU.error = '発効年月より未来に設定してください。'#EOL#}"/><Script EventP="BC;BU" EventR="AR()" Function="" Name="上位部門のエラー検査" Order="0020" Text="//////////////////////////////////////////////#EOL#// Javaパッケージの導入 for Class ArrayList //#EOL#//////////////////////////////////////////////#EOL#var importedPackage = new JavaImporter(java.util);#EOL#with (importedPackage) {#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 変数定義 //#EOL#&#x9;//////////////#EOL#&#x9;var rAT011;#EOL#&#x9;var tougaibumon = ''; //当該部門CD//#EOL#&#x9;var jyouibumon = '';  //上位部門CD//#EOL#&#x9;var dthakkounengetsu = ''; //発効年月//#EOL#&#x9;var dtsikkounengetsu = ''; //失効年月//#EOL#&#x9;var jyouibumonList = new ArrayList(); //上位部門CDリスト//#EOL#&#x9;var dthakkounengetsuList = new ArrayList(); //発効年月リスト//#EOL#&#x9;var dtsikkounengetsuList = new ArrayList(); //失効年月リスト//#EOL##EOL#&#x9;if (AT011_CDJYOUIBUMON.value != '') {#EOL##EOL#&#x9;&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;// '00001'のような値が数値の1として比較されないために明示的に //#EOL#&#x9;&#x9;// 両辺を文字列化したうえで、部門Ｃと上位部門Ｃとを比較する   //#EOL#&#x9;&#x9;////////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;tougaibumon = AT011_CDBUMON.value + '';#EOL#&#x9;&#x9;jyouibumon = AT011_CDJYOUIBUMON.value + '';#EOL#&#x9;&#x9;if (tougaibumon == jyouibumon) {#EOL#&#x9;&#x9;&#x9;AT011_CDJYOUIBUMON.error = '自分自身を上位部門としては指定できません。';#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// 階層ループチェック //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;jyouibumonList.add(jyouibumon);#EOL#&#x9;&#x9;&#x9;dthakkounengetsuList.add(AT011_DTHAKKOUNENGETSU.value);#EOL#&#x9;&#x9;&#x9;dtsikkounengetsuList.add(AT011_DTSIKKOUNENGETSU.value);#EOL#&#x9;&#x9;&#x9;for (var i = 0; i &lt; jyouibumonList.size(); i++) {#EOL#&#x9;&#x9;&#x9;&#x9;rAT011 = instance.createTableOperator('Select', 'AT011');#EOL#&#x9;&#x9;&#x9;&#x9;rAT011.addKeyValue('CDBUMON',&#x9;&#x9;&#x9;&#x9;jyouibumonList.get(i));#EOL#&#x9;&#x9;&#x9;&#x9;rAT011.addKeyValue('DTHAKKOUNENGETSU &lt;',&#x9;dtsikkounengetsuList.get(i));#EOL#&#x9;&#x9;&#x9;&#x9;rAT011.addKeyValue('DTSIKKOUNENGETSU >',&#x9;dthakkounengetsuList.get(i));#EOL#&#x9;&#x9;&#x9;&#x9;while(rAT011.next()) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;jyouibumon = rAT011.getValueOf('CDJYOUIBUMON') + '';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;dthakkounengetsu = rAT011.getValueOf('DTHAKKOUNENGETSU');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;dtsikkounengetsu = rAT011.getValueOf('DTSIKKOUNENGETSU');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (jyouibumon == tougaibumon) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;AT011_CDJYOUIBUMON.error = '指定の部門が階層上でループします。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;i = jyouibumonList.size();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;jyouibumonList.add(jyouibumon);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;dthakkounengetsuList.add(dthakkounengetsu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;dtsikkounengetsuList.add(dtsikkounengetsu);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}"/><Script EventP="BC" EventR="BR()" Function="" Name="追加時初期設定" Order="0030" Text="if (AT011_DTHAKKOUNENGETSU.value == '') {#EOL#&#x9;AT011_DTHAKKOUNENGETSU.value = session.getThisMonth() + '';#EOL#}#EOL#if (AT011_DTSIKKOUNENGETSU.value == '') {#EOL#&#x9;AT011_DTSIKKOUNENGETSU.value = '999912';#EOL#}"/></Table><Table ActiveWhere="" ID="AT020" Name="従業員" RangeKey="" Remarks="従業員情報を保持するためのテーブル" SubsystemID="A"><Field ID="NRJYUGYOIN" Name="従業員№" Nullable="F" Order="0" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXKANA" Name="カナ名" Nullable="F" Order="1" Remarks="" Size="30" Type="CHAR" TypeOptions="KATAKANA"/><Field ID="TXKANJI" Name="漢字名" Nullable="F" Order="2" Remarks="" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field ID="KBKOYOU" Name="雇用区分" Nullable="F" Order="3" Remarks="" Size="5" Type="CHAR" TypeOptions="KUBUN(KBKOYOU)"/><Field ID="DTNYUSYA" Name="入社日" Nullable="F" Order="4" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Field ID="DTTAISYA" Name="退社日" Nullable="T" Order="5" Remarks="" Size="10" Type="DATE" TypeOptions=""/><Key Fields="NRJYUGYOIN" Type="PK"/><Script EventP="BD" EventR="BR()" Function="" Name="削除チェック" Order="0000" Text="var rAT010 = instance.createTableOperator('Count', 'AT010');#EOL#rAT010.addKeyValue('NRKANRISYA',&#x9;AT020_NRJYUGYOIN.value);#EOL#if (rAT010.execute() > 0) {#EOL#&#x9;AT020_NRJYUGYOIN.error = 'この従業員は部門の管理者として定義されているので、削除できません。';#EOL#}#EOL##EOL#var rAT021 = instance.createTableOperator('Count', 'AT021');#EOL#rAT021.addKeyValue('NRJYUGYOIN',&#x9;AT020_NRJYUGYOIN.value);#EOL#if (rAT021.execute() > 0) {#EOL#&#x9;AT020_NRJYUGYOIN.error = '関連する所属部門定義を削除した後でないと、この従業員は削除できません。';#EOL#}#EOL##EOL#var rZT020 = instance.createTableOperator('Count', 'ZT020');#EOL#rZT020.addKeyValue('NREMPLOYEE',&#x9;AT020_NRJYUGYOIN.value);#EOL#if (rZT020.execute() > 0) {#EOL#&#x9;AT020_NRJYUGYOIN.error = '関連するユーザ定義を削除した後でないと、この従業員は削除できません。';#EOL#}"/></Table><Table ActiveWhere="" ID="AT021" Name="従業員所属部門" RangeKey="" Remarks="従業員の所属部門を保持するためのテーブル。従業員毎に年月期間別の所属部門が定義される。" SubsystemID="A"><Field ID="NRJYUGYOIN" Name="従業員№" Nullable="F" Order="0010" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Field ID="DTSYOZOKUNENGETSU" Name="所属開始年月" Nullable="F" Order="0020" Remarks="" Size="6" Type="CHAR" TypeOptions="YMONTH"/><Field ID="CDBUMON" Name="部門Ｃ" Nullable="F" Order="0030" Remarks="" Size="5" Type="CHAR" TypeOptions=""/><Key Fields="NRJYUGYOIN;DTSYOZOKUNENGETSU" Type="PK"/><Refer Fields="TXKANJI;TXKANA;DTTAISYA" Order="0" OrderBy="" TableAlias="" ToKeyFields="" ToTable="AT020" WithKeyFields="AT021.NRJYUGYOIN"/><Refer Fields="TXBUMON" Order="1" TableAlias="" ToKeyFields="" ToTable="AT010" WithKeyFields="AT021.CDBUMON"/><Script EventP="BC;BU;AR" EventR="AR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="//////////////////#EOL#// 所属最終年月 //#EOL#//////////////////#EOL#var lastYearMonth = '999912';#EOL#if (AT021_DTSYOZOKUNENGETSU.value != '') {#EOL#&#x9;var rAT021 = instance.createTableOperator('Select', 'AT021');#EOL#&#x9;rAT021.addKeyValue('NRJYUGYOIN',&#x9;AT021_NRJYUGYOIN.value);#EOL#&#x9;rAT021.setOrderBy('NRJYUGYOIN, DTSYOZOKUNENGETSU');#EOL#&#x9;while (rAT021.next()) {#EOL#&#x9;&#x9;if (rAT021.getValueOf('DTSYOZOKUNENGETSU') > AT021_DTSYOZOKUNENGETSU.value) {#EOL#&#x9;&#x9;&#x9;var workString = rAT021.getValueOf('DTSYOZOKUNENGETSU') + '';#EOL#&#x9;&#x9;&#x9;var workIntYear = workString.substring(0,4);#EOL#&#x9;&#x9;&#x9;var workIntMonth = workString.substring(4,6);#EOL##EOL#&#x9;&#x9;&#x9;workIntMonth = workIntMonth - 1;#EOL#&#x9;&#x9;&#x9;if (workIntMonth == 0) {#EOL#&#x9;&#x9;&#x9;&#x9;workIntMonth = 12;#EOL#&#x9;&#x9;&#x9;&#x9;workIntYear = workIntYear - 1;#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (workIntMonth >= 10) {#EOL#&#x9;&#x9;&#x9;&#x9;lastYearMonth = workIntYear + workIntMonth + '';#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;lastYearMonth = workIntYear + '0' + workIntMonth + '';#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;break;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL#if (AT020_DTTAISYA.value != '') {#EOL#&#x9;var nyusyaDate = AT020_DTTAISYA.value;#EOL#&#x9;var nyusyaYearMonth = nyusyaDate.replace('-','').substring(0,6);#EOL#&#x9;if (lastYearMonth > nyusyaYearMonth) {#EOL#&#x9;&#x9;lastYearMonth = nyusyaYearMonth;#EOL#&#x9;}#EOL#}#EOL#AT021_DTLASTNENGETSU.value = lastYearMonth;#EOL#AT021_DTLASTNENGETSU.editable = false;#EOL##EOL#//////////////////////#EOL#// 現行メンバー区分 //#EOL#//////////////////////#EOL#var today = session.getToday() + '';#EOL#var currentYearMonth = today.replace('-','').substring(0,6);#EOL#if (currentYearMonth >= AT021_DTSYOZOKUNENGETSU.value &amp;&amp; currentYearMonth &lt;= AT021_DTLASTNENGETSU.value) {#EOL#&#x9;AT021_FGPRESENT.value = 'T';#EOL#} else {#EOL#&#x9;AT021_FGPRESENT.value = 'F';#EOL#}"/><Field ID="DTLASTNENGETSU" Name="所属最終年月" Nullable="F" Order="0032" Remarks="" Size="6" Type="CHAR" TypeOptions="VIRTUAL,YMONTH"/><Field ColumnName="現行メンバー" ID="FGPRESENT" Name="現行メンバー区分" NoUpdate="F" Nullable="F" Order="0042" Size="1" Type="CHAR" TypeOptions="VIRTUAL,KUBUN(KBFLAG1)"/></Table><Table ActiveWhere="" ID="ZT070" Name="休日テーブル" RangeKey="" Remarks="公休日や会社の特別休日の情報を保持するためのテーブル。日付選択用カレンダーの休日表示設定のために利用される。" SubsystemID="Z"><Field ID="DTOFF" Name="休日日付" Nullable="F" Order="0020" Size="10" Type="DATE" TypeOptions=""/><Field ID="TXOFF" Name="摘要" Nullable="T" Order="0030" Size="20" Type="CHAR" TypeOptions="KANJI"/><Key Fields="KBCALENDAR;DTOFF" Type="PK"/><Field ID="KBCALENDAR" Name="カレンダー区分" Nullable="F" Order="0010" Size="2" Type="CHAR" TypeOptions="KUBUN(KBCALENDAR)"/></Table><Table ActiveWhere="" ID="ZT040" Name="ユーザ定義区分" RangeKey="" Remarks="キー値と摘要の組み合わせで定義できる区分情報を保持するためのテーブル" SubsystemID="Z"><Field ID="IDUSERKUBUN" Name="区分ID" Nullable="F" Order="0010" Size="20" Type="CHAR" TypeOptions=""/><Field ID="KBUSERKUBUN" Name="区分値" Nullable="F" Order="0020" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXUSERKUBUN" Name="区分値摘要" Nullable="F" Order="0030" Size="20" Type="CHAR" TypeOptions="KANJI"/><Field ID="SQLIST" Name="一覧順序" Nullable="T" Order="0040" Size="5" Type="CHAR" TypeOptions=""/><Key Fields="IDUSERKUBUN;KBUSERKUBUN" Type="PK"/><Field ID="KBVALUE1" Name="１桁区分値" Nullable="F" Order="0050" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="1" Type="CHAR" TypeOptions="VIRTUAL"/><Field ID="KBVALUE2" Name="２桁区分値" Nullable="F" Order="0051" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="2" Type="CHAR" TypeOptions="VIRTUAL"/><Field ID="KBVALUE3" Name="３桁区分値" Nullable="F" Order="0052" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="3" Type="CHAR" TypeOptions="VIRTUAL"/><Field ID="KBVALUE4" Name="４桁区分値" Nullable="F" Order="0053" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="4" Type="CHAR" TypeOptions="VIRTUAL"/><Script EventP="AR" EventR="BR()" Function="" Name="仮想フィールドの設定" Order="0000" Text="ZT040_KBVALUE1.value = ZT040_KBUSERKUBUN.value;#EOL#ZT040_KBVALUE2.value = ZT040_KBUSERKUBUN.value;#EOL#ZT040_KBVALUE3.value = ZT040_KBUSERKUBUN.value;#EOL#ZT040_KBVALUE4.value = ZT040_KBUSERKUBUN.value;#EOL#ZT040_KBVALUE5.value = ZT040_KBUSERKUBUN.value;"/><Field ID="KBVALUE5" Name="５桁区分値" Nullable="F" Order="0054" Remarks="値交換用の仮想フィールド。区分値がセットされる" Size="4" Type="CHAR" TypeOptions="VIRTUAL"/></Table><Table ActiveWhere="" ID="ZT020" Name="ユーザ" RangeKey="" Remarks="ユーザ定義を保持するためのテーブル。ユーザは必ずしも従業員と関連されている必要はない。" SubsystemID="Z"><Field ID="IDUSER" Name="ユーザID" Nullable="F" Order="0010" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXPASSWORD" Name="パスワード" Nullable="F" Order="0030" Remarks="ユーザの指定値が、システム定義の「ハッシュ方式」にもとづいて異化されたうえで保管される" Size="50" Type="CHAR" TypeOptions=""/><Field ID="DTVALID" Name="発効日" Nullable="F" Order="0040" Size="10" Type="DATE" TypeOptions=""/><Field ID="DTEXPIRE" Name="失効日" Nullable="F" Order="0050" Size="10" Type="DATE" TypeOptions=""/><Field ID="TXMENUS" Name="利用可能メニュー" Nullable="F" Order="0070" Size="30" Type="CHAR" TypeOptions=""/><Key Fields="IDUSER" Type="PK"/><Script EventP="BC;BU" EventR="BR()" Name="失効日のエラー検査" Order="0" Text="if (ZT020_DTEXPIRE.value != '' &amp;&amp; ZT020_DTEXPIRE.value &lt;=  ZT020_DTVALID.value) {#EOL# ZT020_DTEXPIRE.error = '発効日より未来に設定してください。'#EOL#}"/><Field ID="NREMPLOYEE" Name="従業員№" Nullable="T" Order="0080" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXNAME" Name="ユーザ名" Nullable="F" Order="0020" Size="30" Type="CHAR" TypeOptions="KANJI"/><Refer Fields="" Order="0010" TableAlias="" ToKeyFields="NRJYUGYOIN" ToTable="AT020" WithKeyFields="ZT020.NREMPLOYEE"/><Script EventP="BC;BU" EventR="BR()" Function="" Name="パスワードの初期化" Order="0010" Text="if (ZT020_TXPASSWORD.value == '') {#EOL#&#x9;ZT020_TXPASSWORD.value = 'f1b708bba17f1ce948dc979f4d7092bc' //&quot;0000000000&quot;のハッシュコード値//#EOL#}"/><Field ID="TXEMAIL" Name="メールアドレス" Nullable="T" Order="0060" Size="40" Type="CHAR" TypeOptions=""/></Table><Table ActiveWhere="" ID="ZT051" Name="セッション明細" RangeKey="" Remarks="セッション毎の機能の利用履歴を保持するためのテーブル" SubsystemID="Z"><Field ID="NRSESSION" Name="セッション№" Nullable="F" Order="0" Size="7" Type="CHAR" TypeOptions=""/><Field ID="SQPROGRAM" Name="行番" Nullable="F" Order="1" Size="4" Type="SMALLINT" TypeOptions=""/><Field ID="IDMENU" Name="メニューID" Nullable="F" Order="2" Size="2" Type="CHAR" TypeOptions=""/><Field ID="IDPROGRAM" Name="プログラムID" Nullable="F" Order="3" Size="10" Type="CHAR" TypeOptions=""/><Field ID="TXPROGRAM" Name="プログラム名" Nullable="F" Order="4" Size="30" Type="CHAR" TypeOptions="KANJI"/><Field ID="DTSTART" Name="利用開始日時" Nullable="F" Order="5" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="DTEND" Name="利用終了日時" Nullable="T" Order="6" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="KBPROGRAMSTATUS" Name="終了状態" Nullable="T" Order="7" Size="2" Type="CHAR" TypeOptions=""/><Field ID="TXERRORLOG" Name="処理ログ" Nullable="T" Order="8" Size="0" Type="LONG VARCHAR" TypeOptions=""/><Key Fields="NRSESSION;SQPROGRAM" Type="PK"/><Script EventP="BC;BU;BD;AR" EventR="AR()" Name="終了状態にもとづく配色設定" Order="0" Text="if (ZT051_KBPROGRAMSTATUS.value == '99') {#EOL#  ZT051_KBPROGRAMSTATUS.color = 'red';#EOL#}"/></Table><Table ActiveWhere="" ID="ZT060" Name="消費税率" RangeKey="" Remarks="開始日別の消費税率を保持するためのテーブル" SubsystemID="Z"><Field ID="DTSTART" Name="開始日" Nullable="F" Order="0" Size="10" Type="DATE" TypeOptions=""/><Field Decimal="2" ID="VLTAXRATE" Name="税率" Nullable="F" Order="1" Size="3" Type="NUMERIC" TypeOptions=""/><Key Fields="DTSTART;KBKAZEI" Type="PK"/><Script EventP="BC;BU" EventR="BR()" Name="消費税率のエラー検査" Order="0" Text="if (ZT060_VLTAXRATE.value >= 1.00) {#EOL# ZT060_VLTAXRATE.error = '1.00より小さい値を設定してください。'#EOL#}"/><Field ID="KBKAZEI" Name="課税区分" NoUpdate="F" Nullable="F" Order="0011" Size="1" Type="CHAR" TypeOptions="KUBUN(KBKAZEI)"/></Table><Table ActiveWhere="" ID="ZT030" Name="採番テーブル" RangeKey="" Remarks="キーフィールド（レコード識別用フィールド）の自動採番を管理するためのテーブル" SubsystemID="Z"><Field ID="IDNUMBER" Name="番号ID" Nullable="F" Order="0" Size="20" Type="CHAR" TypeOptions=""/><Field ID="TXPREFIX" Name="冒頭文字" Nullable="T" Order="1" Size="4" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="NRNUMDIGIT" Name="数字部桁" Nullable="F" Order="2" Size="2" Type="SMALLINT" TypeOptions=""/><Field ID="NRCURRENT" Name="現在番号値" Nullable="F" Order="3" Size="9" Type="INTEGER" TypeOptions=""/><Field ID="FGWITHCD" Name="CD付加フラグ" Nullable="F" Order="4" Remarks="値がT(真)であれば、採番値の末尾にチェックデジット（モジュラス１０）を付加する。したがって冒頭文字を１文字指定して、チェックデジットを指定すれば、採番値は数字部桁に２を足した長さになる。" Size="1" Type="CHAR" TypeOptions="KUBUN(KBFLAG1)"/><Key Fields="IDNUMBER" Type="PK"/></Table><Table ActiveWhere="" ID="ZT050" Name="セッション" RangeKey="" Remarks="ユーザがシステムにログインすることで開始されるセッションの履歴を保持するためのテーブル" SubsystemID="Z"><Field ID="NRSESSION" Name="セッション№" Nullable="F" Order="0010" Size="7" Type="CHAR" TypeOptions=""/><Field ID="DTLOGIN" Name="ログイン日時" Nullable="F" Order="0020" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="DTLOGOUT" Name="ログアウト日時" Nullable="T" Order="0030" Size="23" Type="DATETIME" TypeOptions=""/><Field ID="IDUSER" Name="ユーザID" Nullable="F" Order="0040" Size="5" Type="CHAR" TypeOptions=""/><Field ID="TXIPADDRESS" Name="ＩＰアドレス" Nullable="F" Order="0050" Size="20" Type="CHAR" TypeOptions=""/><Field ID="KBSESSIONSTATUS" Name="状態" Nullable="F" Order="0070" Size="3" Type="CHAR" TypeOptions="VALUES(ACT;ERR;END)"/><Key Fields="NRSESSION" Type="PK"/><Refer Fields="TXNAME" Order="0" OrderBy="" TableAlias="" ToKeyFields="" ToTable="ZT020" WithKeyFields="ZT050.IDUSER"/><Script EventP="BC;BU;BD;AR" EventR="AR()" Name="セッション状態にもとづく配色設定" Order="0" Text="if (ZT050_KBSESSIONSTATUS.value == 'ERR') {#EOL#  ZT050_KBSESSIONSTATUS.color = 'red';#EOL#}#EOL#if (ZT050_KBSESSIONSTATUS.value.equals('ACT')) {#EOL#  ZT050_KBSESSIONSTATUS.color = 'green';#EOL#}"/><Field ID="VLVERSION" Name="処理系バージョン" Nullable="F" Order="0060" Size="10" Type="CHAR" TypeOptions=""/></Table><Table ActiveWhere="" ID="ZT010" Name="システム変数" RangeKey="" Remarks="企業名や年度開始月といったシステム変数を保持するためのテーブル" SubsystemID="Z"><Field ID="IDVARIANT" Name="変数ID" Nullable="F" Order="0010" Size="20" Type="CHAR" TypeOptions=""/><Field ID="TXTYPE" Name="変数タイプ" Nullable="F" Order="0030" Size="10" Type="CHAR" TypeOptions="VALUES(STRING;NUMBER)"/><Field ID="TXVALUE" Name="変数値" Nullable="F" Order="0040" Size="100" Type="CHAR" TypeOptions=""/><Key Fields="IDVARIANT" Type="PK"/><Field ID="TXNAME" Name="変数名" Nullable="F" Order="0020" Size="10" Type="CHAR" TypeOptions="KANJI"/><Field ID="TXREMARKS" Name="摘要" Nullable="T" Order="0041" Remarks="" Size="500" Type="VARCHAR" TypeOptions="KANJI"/></Table><Table ActiveWhere="" ID="ZT081" Name="月次為替レート" RangeKey="" Remarks="月次為替レートを保持するためのテーブル" SubsystemID="Z"><Field ID="KBCURRENCY" Name="通貨区分" Nullable="F" Order="0000" Size="5" Type="CHAR" TypeOptions="KUBUN(KBCURRENCY)"/><Field ID="DTNEND" Name="年度" Nullable="F" Order="0001" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field ID="DTMSEQ" Name="月度" Nullable="F" Order="0011" Size="2" Type="SMALLINT" TypeOptions="MSEQ"/><Field Decimal="3" ID="VLRATEB" Name="TTBレート" Nullable="F" Order="0012" Size="10" Type="NUMERIC" TypeOptions=""/><Field Decimal="3" ID="VLRATEM" Name="TTMレート" Nullable="F" Order="0013" Size="10" Type="NUMERIC" TypeOptions=""/><Field Decimal="3" ID="VLRATES" Name="TTSレート" Nullable="F" Order="0014" Size="10" Type="NUMERIC" TypeOptions=""/><Key Fields="KBCURRENCY;DTNEND;DTMSEQ" Type="PK"/></Table><Table ActiveWhere="" ID="ZT080" Name="年次為替レート" RangeKey="" Remarks="年次為替レートを保持するためのテーブル" SubsystemID="Z"><Field ID="KBCURRENCY" Name="通貨区分" Nullable="F" Order="0010" Size="5" Type="CHAR" TypeOptions="KUBUN(KBCURRENCY)"/><Field Decimal="3" ID="VLRATEB" Name="TTBレート" Nullable="F" Order="0030" Size="10" Type="NUMERIC" TypeOptions=""/><Field ID="DTNEND" Name="年度" Nullable="F" Order="0020" Size="4" Type="SMALLINT" TypeOptions="FYEAR"/><Field Decimal="3" ID="VLRATEM" Name="TTMレート" Nullable="F" Order="0031" Size="10" Type="NUMERIC" TypeOptions=""/><Field Decimal="3" ID="VLRATES" Name="TTSレート" Nullable="F" Order="0032" Size="10" Type="NUMERIC" TypeOptions=""/><Key Fields="KBCURRENCY;DTNEND" Type="PK"/></Table><Table ActiveWhere="" ID="ZT021" Name="ユーザフィルター値" RangeKey="" Remarks="XF100およびXF110でのフィルター値をユーザ毎に保管・復元するためのテーブル" SubsystemID="Z"><Field Decimal="" ID="IDUSER" Name="ユーザID" Nullable="F" Order="0000" Size="5" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="IDFUNCTION" Name="ファンクションID" Nullable="F" Order="0010" Size="20" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="IDFILTER" Name="フィルターID" Nullable="F" Order="0020" Size="40" Type="CHAR" TypeOptions=""/><Field Decimal="" ID="TXVALUE" Name="フィルター値" Nullable="T" Order="0030" Size="50" Type="CHAR" TypeOptions=""/><Key Fields="IDUSER;IDFUNCTION;IDFILTER" Type="PK"/></Table><Table ActiveWhere="" ID="Ｔ音声情報" Name="Ｔ音声情報" RangeKey="" Remarks="" SubsystemID="P"><Field ID="ＩＤ" Name="ＩＤ" NoUpdate="F" Nullable="F" Order="0000" Size="9" Type="INTEGER" TypeOptions="AUTO_NUMBER(音声情報ＩＤ)"/><Field ID="文章" Name="文章" NoUpdate="F" Nullable="F" Order="0000" Size="1000" Type="VARCHAR" TypeOptions="KANJI"/><Field ID="音声ファイル" Name="音声ファイル" NoUpdate="F" Nullable="T" Order="0010" Size="50" Type="VARCHAR" TypeOptions=""/><Field ID="表示順" Name="表示順" NoUpdate="F" Nullable="T" Order="0010" Size="9" Type="INTEGER" TypeOptions=""/><Field ID="摘要" Name="摘要" NoUpdate="F" Nullable="T" Order="0020" Size="10000" Type="VARCHAR" TypeOptions="KANJI"/><Field ID="有効フラグ" Name="有効フラグ" NoUpdate="F" Nullable="F" Order="0020" Size="1" Type="CHAR" TypeOptions="KUBUN(KBFLAG2)"/><Key Fields="ＩＤ" Type="PK"/><Script EventP="BR;BC" EventR="AR()" Function="" Name="初期値設定" Order="0000" Text="if (Ｔ音声情報_有効フラグ.value == '') {#EOL# Ｔ音声情報_有効フラグ.value = 'T'#EOL#}#EOL#"/><Script EventP="AR" EventR="BR()" Function="" Name="キー取得" Order="0010" Text="session.setAttribute('PFormID', Ｔ音声情報_ＩＤ.value);"/></Table><Function DetailFunction="AF011" ID="AF010" InitialListing="T" InitialMsg="" KeyFields="" Name="部門情報の一覧・保守" OrderBy="AT010.CDBUMON" PrimaryTable="AT010" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT010.TXBUMON" FieldOptions="SCAN,CAPTION(部門名SCAN)" Order="0"/><Column DataSource="AT010.TXBUMON" FieldOptions="" Order="1"/><Column DataSource="AT010.NRKANRISYA" FieldOptions="" Order="2"/><Column DataSource="AT020.TXKANJI" FieldOptions="CAPTION(管理者名)" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(AF012)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="部門情報" ID="AF012" InitialMsg="" KeyFields="" Name="部門情報の保守" PrimaryTable="AT010" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT010.CDBUMON" FieldOptions="" Order="0010"/><Field DataSource="AT010.TXBUMON" FieldOptions="" Order="0020"/><Field DataSource="AT010.NRKANRISYA" FieldOptions="" Order="0030"/><Field DataSource="AT020.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT010.TXTEKIYO" FieldOptions="" Order="0050"/></Function><Function DataName="上位部門" ID="AF013" InitialMsg="" KeyFields="" Name="上位部門の保守" PrimaryTable="AT011" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT011.CDBUMON" FieldOptions="" Order="0010"/><Field DataSource="AT010A1.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0020"/><Field DataSource="AT011.CDJYOUIBUMON" FieldOptions="" Order="0030"/><Field DataSource="AT010A2.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Field DataSource="AT011.DTHAKKOUNENGETSU" FieldOptions="" Order="0050"/><Field DataSource="AT011.DTSIKKOUNENGETSU" FieldOptions="HORIZONTAL" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="AF021" ID="AF020" InitialListing="T" InitialMsg="" KeyFields="" Name="従業員情報の一覧・保守" OrderBy="AT020.TXKANA" PrimaryTable="AT020" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT020.TXKANJI" FieldOptions="SCAN,CAPTION(漢字名SCAN)" Order="0"/><Filter DataSource="AT020.TXKANA" FieldOptions="SCAN,CAPTION(カナ名SCAN)" Order="1"/><Filter DataSource="AT020.KBKOYOU" FieldOptions="PROMPT_LIST1" Order="2"/><Column DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Column DataSource="AT020.TXKANJI" FieldOptions="" Order="1"/><Column DataSource="AT020.TXKANA" FieldOptions="" Order="2"/><Column DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(AF022)" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function HeaderFunction="AF022" HeaderKeyFields="" HeaderTable="AT020" ID="AF021" Name="従業員と関連情報の確認" Size="AUTO" SubsystemID="A" Type="XF300"><Field DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Field DataSource="AT020.TXKANA" FieldOptions="" Order="1"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="2"/><Field DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Field DataSource="AT020.DTNYUSYA" FieldOptions="HORIZONTAL" Order="4"/><Field DataSource="AT020.DTTAISYA" FieldOptions="HORIZONTAL" Order="5"/><Detail Caption="所属部門" DetailFunction="AF023" InitialMsg="" KeyFields="" Order="0" OrderBy="" Table="AT021"><Column DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="" Order="0"/><Column DataSource="AT021.CDBUMON" FieldOptions="" Order="1"/><Column DataSource="AT010.TXBUMON" FieldOptions="CAPTION(所属部門名)" Order="2"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="HEADER" Caption="従業員情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail></Function><Function DataName="従業員" ID="AF022" InitialMsg="" KeyFields="" Name="従業員情報の保守" PrimaryTable="AT020" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Field DataSource="AT020.TXKANA" FieldOptions="" Order="1"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="2"/><Field DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Field DataSource="AT020.DTNYUSYA" FieldOptions="" Order="4"/><Field DataSource="AT020.DTTAISYA" FieldOptions="" Order="5"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="所属情報" ID="AF023" InitialMsg="" KeyFields="" Name="従業員所属情報の保守" PrimaryTable="AT021" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT021.NRJYUGYOIN" FieldOptions="" Order="0010"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="0020"/><Field DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="CAPTION(所属期間)" Order="0030"/><Field DataSource="AT021.CDBUMON" FieldOptions="PROMPT_CALL(AF100),PROMPT_CALL_TO_GET(AT010.CDBUMON;AT010.TXBUMON),PROMPT_CALL_TO_GET_TO(AT021.CDBUMON;AT010.TXBUMON)" Order="0050"/><Field DataSource="AT010.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT021.DTLASTNENGETSU" FieldOptions="CAPTION(～),CAPTION_LENGTH_VARIABLE,HORIZONTAL" Order="0040"/></Function><Function DataName="所属情報" ID="AF024" InitialMsg="" KeyFields="" Name="従業員所属情報の表示" PrimaryTable="AT021" Size="AUTO" SubsystemID="A" Type="XF200"><Field DataSource="AT021.NRJYUGYOIN" FieldOptions="" Order="0010"/><Field DataSource="AT020.TXKANJI" FieldOptions="" Order="0020"/><Field DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="CAPTION(所属期間)" Order="0030"/><Field DataSource="AT021.CDBUMON" FieldOptions="" Order="0050"/><Field DataSource="AT010.TXBUMON" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="AT021.DTLASTNENGETSU" FieldOptions="CAPTION(～),CAPTION_LENGTH_VARIABLE,HORIZONTAL" Order="0040"/></Function><Function DetailFunction="" ID="AF100" InitialListing="T" InitialMsg="" KeyFields="" Name="部門検索関数" OrderBy="AT010.CDBUMON" ParmType="COLUMNS" PrimaryTable="AT010" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT010.TXBUMON" FieldOptions="SCAN,CAPTION(部門名SCAN)" Order="0"/><Column DataSource="AT010.CDBUMON" FieldOptions="" Order="0"/><Column DataSource="AT010.TXBUMON" FieldOptions="" Order="1"/><Column DataSource="AT010.NRKANRISYA" FieldOptions="" Order="2"/><Column DataSource="AT020.TXKANJI" FieldOptions="CAPTION(管理者名)" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/></Function><Function DetailFunction="" ID="AF110" InitialListing="T" InitialMsg="" KeyFields="" Name="従業員検索関数" OrderBy="AT020.TXKANA" ParmType="COLUMNS" PrimaryTable="AT020" Size="AUTO" SubsystemID="A" Type="XF100"><Filter DataSource="AT020.TXKANJI" FieldOptions="SCAN,CAPTION(漢字名SCAN)" Order="0"/><Filter DataSource="AT020.TXKANA" FieldOptions="SCAN,CAPTION(カナ名SCAN)" Order="1"/><Filter DataSource="AT020.KBKOYOU" FieldOptions="PROMPT_LIST1" Order="2"/><Column DataSource="AT020.NRJYUGYOIN" FieldOptions="" Order="0"/><Column DataSource="AT020.TXKANJI" FieldOptions="" Order="1"/><Column DataSource="AT020.TXKANA" FieldOptions="" Order="2"/><Column DataSource="AT020.KBKOYOU" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/></Function><Function DetailFunction="ZF011" ID="ZF010" InitialListing="T" InitialMsg="" KeyFields="" Name="システム変数の一覧・保守" OrderBy="ZT010.IDVARIANT" PrimaryTable="ZT010" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT010.IDVARIANT" FieldOptions="" Order="0010"/><Column DataSource="ZT010.TXTYPE" FieldOptions="" Order="0040"/><Column DataSource="ZT010.TXVALUE" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT010.TXNAME" FieldOptions="SCAN,CAPTION(変数名SCAN)" Order="0010"/><Column DataSource="ZT010.TXNAME" FieldOptions="" Order="0030"/></Function><Function DataName="システム変数" ID="ZF011" InitialMsg="" KeyFields="" Name="システム変数の保守" PrimaryTable="ZT010" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT010.IDVARIANT" FieldOptions="" Order="0010"/><Field DataSource="ZT010.TXTYPE" FieldOptions="" Order="0030"/><Field DataSource="ZT010.TXVALUE" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="ZT010.TXNAME" FieldOptions="" Order="0020"/><Field DataSource="ZT010.TXREMARKS" FieldOptions="" Order="0050"/></Function><Function DetailFunction="ZF021" ID="ZF020" InitialListing="T" InitialMsg="" KeyFields="" Name="ユーザの一覧・保守" OrderBy="ZT020.IDUSER" PrimaryTable="ZT020" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT020.IDUSER" FieldOptions="" Order="0010"/><Column DataSource="ZT020.TXMENUS" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT020.TXNAME" FieldOptions="SCAN,CAPTION(ユーザ名SCAN)" Order="0010"/><Column DataSource="ZT020.TXNAME" FieldOptions="" Order="0020"/><Column DataSource="ZT020.TXEMAIL" FieldOptions="" Order="0030"/><Column DataSource="ZT020.NREMPLOYEE" FieldOptions="" Order="0040"/></Function><Function DataName="" ID="ZF021" InitialMsg="" KeyFields="" Name="ユーザの保守" PrimaryTable="ZT020" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT020.IDUSER" FieldOptions="" Order="0010"/><Field DataSource="ZT020.TXPASSWORD" FieldOptions="COMMENT(デフォルトは0000000000のハッシュ値。セッション中でユーザ自身がF12で変更できます。)" Order="0040"/><Field DataSource="ZT020.DTVALID" FieldOptions="" Order="0050"/><Field DataSource="ZT020.DTEXPIRE" FieldOptions="" Order="0060"/><Field DataSource="ZT020.TXMENUS" FieldOptions="COMMENT(メニューＩＤをコンマで区切って指定するか、ALLを指定してください。)" Order="0080"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="ZT020.NREMPLOYEE" FieldOptions="" Order="0020"/><Field DataSource="ZT020.TXNAME" FieldOptions="" Order="0030"/><Field DataSource="ZT020.TXEMAIL" FieldOptions="" Order="0070"/></Function><Function DetailFunction="ZF031" ID="ZF030" InitialListing="T" InitialMsg="" KeyFields="" Name="採番定義の一覧・保守" OrderBy="ZT030.IDNUMBER" PrimaryTable="ZT030" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT030.IDNUMBER" FieldOptions="SCAN,CAPTION(番号ＩＤ SCAN)" Order="0"/><Column DataSource="ZT030.IDNUMBER" FieldOptions="" Order="0"/><Column DataSource="ZT030.TXPREFIX" FieldOptions="" Order="1"/><Column DataSource="ZT030.NRNUMDIGIT" FieldOptions="" Order="2"/><Column DataSource="ZT030.NRCURRENT" FieldOptions="" Order="3"/><Column DataSource="ZT030.FGWITHCD" FieldOptions="CAPTION(C/D)" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="採番定義" ID="ZF031" InitialMsg="" KeyFields="" Name="採番定義の保守" PrimaryTable="ZT030" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT030.IDNUMBER" FieldOptions="" Order="0"/><Field DataSource="ZT030.TXPREFIX" FieldOptions="" Order="1"/><Field DataSource="ZT030.NRNUMDIGIT" FieldOptions="" Order="2"/><Field DataSource="ZT030.NRCURRENT" FieldOptions="" Order="3"/><Field DataSource="ZT030.FGWITHCD" FieldOptions="" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF041" ID="ZF040" InitialListing="T" InitialMsg="" KeyFields="" Name="ユーザ定義区分の一覧・保守" OrderBy="ZT040.IDUSERKUBUN;ZT040.SQLIST" PrimaryTable="ZT040" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT040.IDUSERKUBUN" FieldOptions="SCAN,CAPTION(区分ＩＤ SCAN)" Order="0"/><Column DataSource="ZT040.IDUSERKUBUN" FieldOptions="" Order="0"/><Column DataSource="ZT040.SQLIST" FieldOptions="" Order="1"/><Column DataSource="ZT040.KBUSERKUBUN" FieldOptions="" Order="2"/><Column DataSource="ZT040.TXUSERKUBUN" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DataName="ユーザ定義区分" ID="ZF041" InitialMsg="" KeyFields="" Name="ユーザ定義区分の保守" PrimaryTable="ZT040" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT040.IDUSERKUBUN" FieldOptions="" Order="0"/><Field DataSource="ZT040.KBUSERKUBUN" FieldOptions="" Order="1"/><Field DataSource="ZT040.TXUSERKUBUN" FieldOptions="" Order="2"/><Field DataSource="ZT040.SQLIST" FieldOptions="" Order="3"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF051" ID="ZF050" InitialMsg="" KeyFields="" Name="セッション状況の一覧" OrderBy="ZT050.NRSESSION(D)" PrimaryTable="ZT050" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT050.DTLOGIN" FieldOptions="GENERIC,CAPTION(ログイン日時)" Order="0"/><Filter DataSource="ZT050.KBSESSIONSTATUS" FieldOptions="PROMPT_LIST1" Order="2"/><Column DataSource="ZT050.NRSESSION" FieldOptions="CAPTION(Session)" Order="0010"/><Column DataSource="ZT050.DTLOGIN" FieldOptions="" Order="0020"/><Column DataSource="ZT050.DTLOGOUT" FieldOptions="" Order="0030"/><Column DataSource="ZT050.IDUSER" FieldOptions="CAPTION(User)" Order="0040"/><Column DataSource="ZT050.TXIPADDRESS" FieldOptions="" Order="0060"/><Column DataSource="ZT050.KBSESSIONSTATUS" FieldOptions="" Order="0080"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="CALL(ZF053)" Caption="LOGIN制御" Number="8" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT020.TXNAME" FieldOptions="SCAN,CAPTION(ユーザ名SCAN)" Order="0012"/><Column DataSource="ZT020.TXNAME" FieldOptions="WIDTH(150)" Order="0050"/><Column DataSource="ZT050.VLVERSION" FieldOptions="CAPTION(処理系)" Order="0070"/></Function><Function HeaderFunction="" HeaderKeyFields="" HeaderTable="ZT050" ID="ZF051" Name="セッションと関連情報の確認" Size="AUTO" SubsystemID="Z" Type="XF300"><Field DataSource="ZT050.NRSESSION" FieldOptions="" Order="0010"/><Field DataSource="ZT050.DTLOGIN" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ZT050.DTLOGOUT" FieldOptions="HORIZONTAL" Order="0030"/><Field DataSource="ZT050.IDUSER" FieldOptions="" Order="0040"/><Field DataSource="ZT050.TXIPADDRESS" FieldOptions="HORIZONTAL(28)" Order="0070"/><Field DataSource="ZT050.KBSESSIONSTATUS" FieldOptions="" Order="0060"/><Detail Caption="機能利用履歴" DetailFunction="ZF052" InitialMsg="" KeyFields="" Order="0" OrderBy="" Table="ZT051"><Column DataSource="ZT051.DTSTART" FieldOptions="" Order="0"/><Column DataSource="ZT051.IDMENU" FieldOptions="" Order="1"/><Column DataSource="ZT051.IDPROGRAM" FieldOptions="" Order="2"/><Column DataSource="ZT051.TXPROGRAM" FieldOptions="" Order="3"/><Column DataSource="ZT051.KBPROGRAMSTATUS" FieldOptions="" Order="4"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Detail><Field DataSource="ZT020.TXNAME" FieldOptions="HORIZONTAL(14)" Order="0050"/><Field DataSource="ZT050.VLVERSION" FieldOptions="HORIZONTAL(42)" Order="0080"/></Function><Function DetailFunction="ZF061" ID="ZF060" InitialListing="T" InitialMsg="" KeyFields="DTSTART;KBKAZEI" Name="消費税率の一覧・保守" OrderBy="ZT060.DTSTART;ZT060.KBKAZEI" PrimaryTable="ZT060" Size="AUTO" SubsystemID="Z" Type="XF100"><Filter DataSource="ZT060.DTSTART" FieldOptions="GENERIC,CAPTION(開始日上位桁)" Order="0"/><Column DataSource="ZT060.DTSTART" FieldOptions="" Order="0010"/><Column DataSource="ZT060.VLTAXRATE" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="ZT060.KBKAZEI" FieldOptions="" Order="0020"/></Function><Function DataName="消費税率" ID="ZF061" InitialMsg="" KeyFields="DTSTART;KBKAZEI" Name="消費税率の保守" PrimaryTable="ZT060" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT060.DTSTART" FieldOptions="" Order="0010"/><Field DataSource="ZT060.VLTAXRATE" FieldOptions="" Order="0030"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="複写" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Field DataSource="ZT060.KBKAZEI" FieldOptions="" Order="0020"/></Function><Function DataName="プログラム利用履歴" ID="ZF052" InitialMsg="" KeyFields="" Name="プログラム利用履歴の確認" PrimaryTable="ZT051" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT051.NRSESSION" FieldOptions="" Order="0010"/><Field DataSource="ZT051.SQPROGRAM" FieldOptions="CAPTION_LENGTH_VARIABLE,HORIZONTAL(70)" Order="0040"/><Field DataSource="ZT051.IDMENU" FieldOptions="HORIZONTAL" Order="0050"/><Field DataSource="ZT051.IDPROGRAM" FieldOptions="CAPTION(プログラム)" Order="0060"/><Field DataSource="ZT051.TXPROGRAM" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0070"/><Field DataSource="ZT051.KBPROGRAMSTATUS" FieldOptions="HORIZONTAL" Order="0080"/><Field DataSource="ZT051.TXERRORLOG" FieldOptions="WIDTH(874),ROWS(16)" Order="0090"/><Field DataSource="ZT051.DTSTART" FieldOptions="" Order="0100"/><Field DataSource="ZT051.DTEND" FieldOptions="HORIZONTAL" Order="0110"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function ID="ZF053" Name="ログイン制御" Script="//////////////////////////#EOL#// Javaパッケージの導入 //#EOL#//////////////////////////#EOL#var importedPackage = new JavaImporter(javax.swing);#EOL#with (importedPackage) {#EOL##EOL#&#x9;//////////////#EOL#&#x9;// 変数定義 //#EOL#&#x9;//////////////#EOL#&#x9;var rZT010; var uZT010;#EOL#&#x9;var count = 0; var errorMessage = ''; var ans;#EOL##EOL#&#x9;//////////////////////////////////////////////////////////////////////////////////////#EOL#&#x9;// システム変数テーブル(ZT010)のログイン認可フラグ(LOGIN_PERMITTED)を調べて更新する //#EOL#&#x9;//////////////////////////////////////////////////////////////////////////////////////#EOL#&#x9;rZT010 = instance.createTableOperator('Select', 'ZT010');#EOL#&#x9;rZT010.addKeyValue('IDVARIANT',&#x9;'LOGIN_PERMITTED');#EOL#&#x9;if (rZT010.next()) {#EOL##EOL#&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;// フラグをログイン禁止(F)として更新する //#EOL#&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;var value  = rZT010.getValueOf('TXVALUE').trim();#EOL#&#x9;&#x9;if (value == 'T') {#EOL##EOL#&#x9;&#x9;&#x9;ans = JOptionPane.showConfirmDialog(null, '新たなログインを禁止しますか？', 'LOGIN制御', JOptionPane.OK_CANCEL_OPTION);#EOL#&#x9;&#x9;&#x9;if (ans == JOptionPane.OK_OPTION) {#EOL#&#x9;&#x9;&#x9;&#x9;uZT010 = instance.createTableOperator('Update', 'ZT010');#EOL#&#x9;&#x9;&#x9;&#x9;uZT010.addValue('TXVALUE',&#x9;'F');#EOL#&#x9;&#x9;&#x9;&#x9;uZT010.addKeyValue('IDVARIANT',&#x9;'LOGIN_PERMITTED');#EOL#&#x9;&#x9;&#x9;&#x9;count = uZT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = 'システム変数(ZT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;} else {#EOL##EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// フラグをログイン認可(T)として更新する //#EOL#&#x9;&#x9;&#x9;///////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;if (value == 'F') {#EOL#&#x9;&#x9;&#x9;&#x9;ans = JOptionPane.showConfirmDialog(null, '現在、新たなログインは禁止されています。解除しますか？', 'LOGIN制御', JOptionPane.OK_CANCEL_OPTION);#EOL#&#x9;&#x9;&#x9;&#x9;if (ans == JOptionPane.OK_OPTION) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uZT010 = instance.createTableOperator('Update', 'ZT010');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uZT010.addValue('TXVALUE','T');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;uZT010.addKeyValue('IDVARIANT','LOGIN_PERMITTED');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;count = uZT010.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;errorMessage = 'システム変数(ZT010)の更新に失敗しました。処理はキャンセルされます。';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;////////////////#EOL#&#x9;&#x9;// エラー処理 //#EOL#&#x9;&#x9;////////////////#EOL#&#x9;&#x9;if (errorMessage != '') {#EOL#&#x9;&#x9;&#x9;instance.cancelWithMessage(errorMessage);#EOL#&#x9;&#x9;}#EOL#&#x9;} else {#EOL#&#x9;&#x9;JOptionPane.showMessageDialog(null, 'ログイン制御用のシステム変数(LOGIN_PERMITTED)が登録されていないので処理できません。');#EOL#&#x9;}#EOL#}" SubsystemID="Z" Type="XF000"/><PrintFont FontName="Times-Roman" ID="Font0" PDFEncoding="Cp1252" PDFFontName="Times-Roman"/><PrintFont FontName="Hゴシック" ID="Font1" PDFEncoding="UniJIS-UCS2-H" PDFFontName="HeiseiKakuGo-W5"/><PrintFont FontName="H明朝" ID="Font2" PDFEncoding="UniJIS-UCS2-H" PDFFontName="HeiseiMin-W3"/><Function DetailFunction="ZF081" ID="ZF080" InitialListing="T" InitialMsg="" KeyFields="" Name="年次為替レートの一覧・保守" OrderBy="" PrimaryTable="ZT080" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT080.KBCURRENCY" FieldOptions="CAPTION(通貨)" Order="0000"/><Column DataSource="ZT080.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="ZT080.VLRATEB" FieldOptions="" Order="0020"/><Column DataSource="ZT080.VLRATEM" FieldOptions="" Order="0030"/><Column DataSource="ZT080.VLRATES" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT080.KBCURRENCY" FieldOptions="PROMPT_LIST1,CAPTION(通貨)" Order="0010"/><Filter DataSource="ZT080.DTNEND" FieldOptions="" Order="0020"/></Function><Function ContinueAdd="T" ID="ZF081" InitialMsg="" KeyFields="" Name="年次為替レートの保守" PrimaryTable="ZT080" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT080.KBCURRENCY" FieldOptions="" Order="0000"/><Field DataSource="ZT080.DTNEND" FieldOptions="HORIZONTAL" Order="0010"/><Field DataSource="ZT080.VLRATEB" FieldOptions="" Order="0020"/><Field DataSource="ZT080.VLRATEM" FieldOptions="" Order="0030"/><Field DataSource="ZT080.VLRATES" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF083" ID="ZF082" InitialListing="T" InitialMsg="" KeyFields="" Name="月次為替レートの一覧・保守" OrderBy="" PrimaryTable="ZT081" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT081.KBCURRENCY" FieldOptions="CAPTION(通貨)" Order="0000"/><Column DataSource="ZT081.DTNEND" FieldOptions="" Order="0010"/><Column DataSource="ZT081.DTMSEQ" FieldOptions="" Order="0020"/><Column DataSource="ZT081.VLRATEB" FieldOptions="" Order="0030"/><Column DataSource="ZT081.VLRATEM" FieldOptions="" Order="0040"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Filter DataSource="ZT081.KBCURRENCY" FieldOptions="PROMPT_LIST1,CAPTION(通貨)" Order="0010"/><Filter DataSource="ZT081.DTNEND" FieldOptions="" Order="0020"/></Function><Function ContinueAdd="T" ID="ZF083" InitialMsg="" KeyFields="" Name="月次為替レートの保守" PrimaryTable="ZT081" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT081.KBCURRENCY" FieldOptions="" Order="0000"/><Field DataSource="ZT081.DTNEND" FieldOptions="HORIZONTAL" Order="0010"/><Field DataSource="ZT081.DTMSEQ" FieldOptions="HORIZONTAL" Order="0020"/><Field DataSource="ZT081.VLRATEB" FieldOptions="" Order="0030"/><Field DataSource="ZT081.VLRATEM" FieldOptions="" Order="0040"/><Field DataSource="ZT081.VLRATES" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function DetailFunction="ZF071" ID="ZF070" InitialListing="T" InitialMsg="" InitialReadCount="" KeyFields="" Name="休日の一覧・保守" OrderBy="" PrimaryTable="ZT070" Size="AUTO" SubsystemID="Z" Type="XF100"><Column DataSource="ZT070.KBCALENDAR" FieldOptions="" Order="0000"/><Column DataSource="ZT070.DTOFF" FieldOptions="" Order="0010"/><Column DataSource="ZT070.TXOFF" FieldOptions="" Order="0020"/><Filter DataSource="ZT070.KBCALENDAR" FieldOptions="PROMPT_LIST1" Order="0000"/><Filter DataSource="ZT070.DTOFF" FieldOptions="GE,CAPTION(日付≧)" Order="0010"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Button Action="CALL(ZF072)" Caption="土日登録" Number="7" Position="4"/></Function><Function ID="ZF071" InitialMsg="" KeyFields="" Name="休日の保守" PrimaryTable="ZT070" Size="AUTO" SubsystemID="Z" Type="XF200"><Field DataSource="ZT070.KBCALENDAR" FieldOptions="" Order="0000"/><Field DataSource="ZT070.DTOFF" FieldOptions="" Order="0010"/><Field DataSource="ZT070.TXOFF" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><MaintenanceLog Descriptions="･「ZT050 セッション」と「ZT051 セッション明細」について、日時項目をTIMESTAMPからDATETIMEに変更した#EOL#･「ZF052 プログラム利用履歴の確認」のレイアウトを変更した#EOL#" Headder="1.0.1" ID="0" SortKey="20140726"/><MaintenanceLog Descriptions="・ユーザ定義区分テーブルの一覧順序を２桁から５桁に拡張した#EOL#・２０１５年向けの休日データを登録した" Headder="1.0.2" ID="1" SortKey="20141207"/><MaintenanceLog Descriptions="・Java1.8に対応するために、スクリプト中のimportPackage()を廃止した" Headder="1.0.3" ID="2" SortKey="20150427"/><Function ID="ZF072" Name="土日一括登録" Script="////////////////////////////#EOL#// 変数とダイアログの定義 //#EOL#////////////////////////////#EOL#var date; var dtOff = ''; var rZT070; var cZT070;#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessageHeight(80);#EOL#var kubun = dialog.addField('カレンダー区分', 'LISTBOX');#EOL#var rZT040 = instance.createTableOperator('Select', 'ZT040'); //ユーザ定義区分の検索用//#EOL#rZT040.addKeyValue('IDUSERKUBUN',&#x9;'KBCALENDAR');#EOL#rZT040.setOrderBy('SQLIST');#EOL#while (rZT040.next()) {#EOL#&#x9;kubun.addItem(rZT040.getValueOf('TXUSERKUBUN'), rZT040.getValueOf('KBUSERKUBUN'));#EOL#}#EOL#var year = dialog.addField('対象年', 'ALPHA');#EOL#var wrkStr = session.getSystemVariantString('ALLOWED_FISCAL_MONTH') + '';#EOL#if (wrkStr != '') { #EOL#&#x9;year.value = Number(wrkStr.substring(0, 4)) + Number(1) + '';#EOL#}#EOL#dialog.setMessage('＊指定された西暦年の土曜と日曜が休日として一括登録されます。既存であれば無視されます。');#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('土日一括登録');#EOL#if (reply == 0) {#EOL##EOL#&#x9;//////////////////////////////////////////#EOL#&#x9;// 土日であればその日付を休日として登録 //#EOL#&#x9;//////////////////////////////////////////#EOL#&#x9;for (month = 0; month &lt; 12; month++) {#EOL#&#x9;&#x9;for (day = 1; day &lt;= 31; day++) {#EOL#&#x9;&#x9;&#x9;date = new Date(year.value, month, day);#EOL#&#x9;&#x9;&#x9;dtOff = year.value + '-' + (month + Number(1)) + '-' + day;#EOL#&#x9;&#x9;&#x9;if(dtOff == (date.getFullYear() + &quot;-&quot; + (date.getMonth() + Number(1)) + &quot;-&quot; + date.getDate())) {#EOL#&#x9;&#x9;&#x9;&#x9;if (date.getDay() == 0 || date.getDay() == 6) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rZT070 = instance.createTableOperator('Count', 'ZT070');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rZT070.addKeyValue('KBCALENDAR',&#x9;kubun.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rZT070.addKeyValue('DTOFF',&#x9;&#x9;&#x9;dtOff);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;if (rZT070.execute() == 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070 = instance.createTableOperator('Insert', 'ZT070');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070.addValue('KBCALENDAR',&#x9;kubun.value);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070.addValue('DTOFF',&#x9;&#x9;dtOff);#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;cZT070.execute();#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;instance.returnMap.put('RETURN_CODE', '10');#EOL#&#x9;instance.commit();#EOL##EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '処理は取り消されました。');#EOL#&#x9;instance.returnMap.put('RETURN_CODE', '01');#EOL#}#EOL#" SubsystemID="Z" Type="XF000"/><MaintenanceLog Descriptions="・休日カレンダーを年指定で土日を一括登録するための機能を設けた" Headder="1.0.4" ID="3" SortKey="20150714"/><Function HeaderFunction="AF012" HeaderKeyFields="" HeaderTable="AT010" ID="AF011" Name="部門と関連情報の確認" Size="AUTO" SubsystemID="A" Type="XF300"><Field DataSource="AT010.CDBUMON" FieldOptions="" Order="0010"/><Field DataSource="AT010.TXBUMON" FieldOptions="" Order="0020"/><Field DataSource="AT010.NRKANRISYA" FieldOptions="" Order="0030"/><Field DataSource="AT020.TXKANJI" FieldOptions="NO_CAPTION,HORIZONTAL" Order="0040"/><Detail Caption="上位部門" DetailFunction="AF013" InitialMsg="" KeyFields="" Order="0" OrderBy="" Table="AT011"><Column DataSource="AT011.DTHAKKOUNENGETSU" FieldOptions="" Order="0010"/><Column DataSource="AT011.CDJYOUIBUMON" FieldOptions="" Order="0030"/><Column DataSource="AT011.DTSIKKOUNENGETSU" FieldOptions="" Order="0060"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="3"/><Button Action="HEADER" Caption="部門情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT010A2.TXBUMON" FieldOptions="CAPTION(上位部門名)" Order="0040"/></Detail><Detail Caption="所属メンバー" DetailFunction="AF024" HeaderKeyFields="CDBUMON" InitialListing="T" InitialMsg="" KeyFields="CDBUMON;NRJYUGYOIN;DTSYOZOKUNENGETSU" Order="1" OrderBy="AT020.TXKANA" Table="AT021"><Column DataSource="AT021.DTSYOZOKUNENGETSU" FieldOptions="" Order="0030"/><Column DataSource="AT020.TXKANJI" FieldOptions="WIDTH(340)" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="HEADER" Caption="部門情報" Number="8" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Column DataSource="AT021.DTLASTNENGETSU" FieldOptions="" Order="0040"/><Filter DataSource="AT021.FGPRESENT" FieldOptions="PROMPT_LIST1,VALUE(T)" Order="0010"/><Column DataSource="AT020.TXKANA" FieldOptions="WIDTH(200)" Order="0010"/><Column DataSource="AT021.FGPRESENT" FieldOptions="" Order="0050"/></Detail><Field DataSource="AT010.TXTEKIYO" FieldOptions="" Order="0050"/></Function><MaintenanceLog Descriptions="・範囲KEY機能の停止にともなって、「AT021 従業員所属部門」の所属最終年月をScriptによる導出項目とするとともに、部門と従業員の削除チェック用Scriptを組み込んだ#EOL#・パージ処理を組み込んだ#EOL#・WEBサービス検証用ダイアログを組み込んだ" Headder="1.0.5" ID="4" SortKey="20160109"/><Function ID="ZFWEBTEST" Name="WEBサービス検証用プログラム" Script="////////////////////////////#EOL#// 変数とダイアログの定義 //#EOL#////////////////////////////#EOL#var reply = 0;#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessageHeight(150);#EOL#dialog.setMessage('WEBサービス用のScriptランチャー機能をテストするためのプログラムです。それぞれの値を入力してエンターすれば、POST要求に対する応答を確認できます。WEBサーバURLを http://localhost:8080/xteaServer/Service のように設定すれば、WEBサーバへの要求として処理されます。');#EOL#var functionID = dialog.addField('FUNCTION', 'ALPHA', 0);#EOL#functionID.setSize(15);#EOL#var requestType = dialog.addField('REQUEST_TYPE', 'ALPHA', 0);#EOL#requestType.setSize(60);#EOL#var additionalParmName1 = dialog.addField('追加パラメータ名1', 'ALPHA', 0);#EOL#additionalParmName1.setSize(15);#EOL#var additionalParmValue1 = dialog.addField('値1', 'ALPHA', 0);#EOL#additionalParmValue1.setSize(60);#EOL#var additionalParmName2 = dialog.addField('追加パラメータ名2', 'ALPHA', 0);#EOL#additionalParmName2.setSize(15);#EOL#var additionalParmValue2 = dialog.addField('値2', 'ALPHA', 0);#EOL#additionalParmValue2.setSize(60);#EOL#var additionalParmName3 = dialog.addField('追加パラメータ名3', 'ALPHA', 0);#EOL#additionalParmName3.setSize(15);#EOL#var additionalParmValue3 = dialog.addField('値3', 'ALPHA', 0);#EOL#additionalParmValue3.setSize(60);#EOL#var additionalParmName4 = dialog.addField('追加パラメータ名4', 'ALPHA', 0);#EOL#additionalParmName4.setSize(15);#EOL#var additionalParmValue4 = dialog.addField('値4', 'ALPHA', 0);#EOL#additionalParmValue4.setSize(60);#EOL#var additionalParmName5 = dialog.addField('追加パラメータ名5', 'ALPHA', 0);#EOL#additionalParmName5.setSize(15);#EOL#var additionalParmValue5 = dialog.addField('値5', 'TEXTAREA', 0);#EOL#additionalParmValue5.setSize(300);#EOL#var url = dialog.addField('WEBサーバURL', 'ALPHA', 0);#EOL#url.setSize(60);#EOL##EOL#////////////////////////////////#EOL#// 項目値にユーザ値を設定する //#EOL#////////////////////////////////#EOL#functionID.setValue(instance.getUserValueOf('FunctionID'));#EOL#requestType.setValue(instance.getUserValueOf('RequestType'));#EOL#additionalParmName1.setValue(instance.getUserValueOf('ParmName1'));#EOL#additionalParmValue1.setValue(instance.getUserValueOf('ParmValue1'));#EOL#additionalParmName2.setValue(instance.getUserValueOf('ParmName2'));#EOL#additionalParmValue2.setValue(instance.getUserValueOf('ParmValue2'));#EOL#additionalParmName3.setValue(instance.getUserValueOf('ParmName3'));#EOL#additionalParmValue3.setValue(instance.getUserValueOf('ParmValue3'));#EOL#additionalParmName4.setValue(instance.getUserValueOf('ParmName4'));#EOL#additionalParmValue4.setValue(instance.getUserValueOf('ParmValue4'));#EOL#additionalParmName5.setValue(instance.getUserValueOf('ParmName5'));#EOL#additionalParmValue5.setValue(instance.getUserValueOf('ParmValue5'));#EOL#url.setValue(instance.getUserValueOf('URL'));#EOL##EOL#////////////////////////////////////#EOL#// ダイアログ表示とPOST処理の起動 //#EOL#////////////////////////////////////#EOL#for (;;) {#EOL#&#x9;reply = dialog.request('WEBサービスの動作検証');#EOL#&#x9;if (reply == 0) {#EOL#&#x9;&#x9;if (url.value == '') {#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('REQUEST_TYPE', requestType.value);#EOL#&#x9;&#x9;&#x9;instance.parmMap.put(additionalParmName1.value, additionalParmValue1.value);#EOL#&#x9;&#x9;&#x9;instance.parmMap.put(additionalParmName2.value, additionalParmValue2.value);#EOL#&#x9;&#x9;&#x9;instance.parmMap.put(additionalParmName3.value, additionalParmValue3.value);#EOL#&#x9;&#x9;&#x9;instance.parmMap.put(additionalParmName4.value, additionalParmValue4.value);#EOL#&#x9;&#x9;&#x9;instance.parmMap.put(additionalParmName5.value, additionalParmValue5.value);#EOL#&#x9;&#x9;&#x9;instance.callFunction(functionID.value);#EOL#&#x9;&#x9;&#x9;var document = instance.returnMap.get('RESULT');#EOL#&#x9;&#x9;&#x9;if (document instanceof org.json.JSONObject) {#EOL#&#x9;&#x9;&#x9;&#x9;dialog.setMessage(document);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (document instanceof org.w3c.dom.Document) {#EOL#&#x9;&#x9;&#x9;&#x9;dialog.setMessage(session.parseXmlDocumentToGetString(document));#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;var post = session.createWebServiceRequest(url.value, 'UTF-8');#EOL#&#x9;&#x9;&#x9;post.setParameter('FUNCTION', functionID.value);#EOL#&#x9;&#x9;&#x9;post.setParameter('REQUEST_TYPE', requestType.value);#EOL#&#x9;&#x9;&#x9;if (additionalParmName1.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;post.setParameter(additionalParmName1.value, additionalParmValue1.value);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (additionalParmName2.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;post.setParameter(additionalParmName2.value, additionalParmValue2.value);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (additionalParmName3.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;post.setParameter(additionalParmName3.value, additionalParmValue3.value);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (additionalParmName4.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;post.setParameter(additionalParmName4.value, additionalParmValue4.value);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;if (additionalParmName5.value != '') {#EOL#&#x9;&#x9;&#x9;&#x9;post.setParameter(additionalParmName5.value, additionalParmValue5.value);#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;var response = post.execute();#EOL#&#x9;&#x9;&#x9;dialog.setMessage(response);#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;// 項目値をユーザ値として保管する //#EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;instance.setUserValueOf('FunctionID',&#x9;functionID.value);#EOL#&#x9;&#x9;instance.setUserValueOf('RequestType',&#x9;requestType.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmName1',&#x9;additionalParmName1.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmValue1',&#x9;additionalParmValue1.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmName2',&#x9;additionalParmName2.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmValue2',&#x9;additionalParmValue2.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmName3',&#x9;additionalParmName3.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmValue3',&#x9;additionalParmValue3.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmName4',&#x9;additionalParmName4.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmValue4',&#x9;additionalParmValue4.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmName5',&#x9;additionalParmName5.value);#EOL#&#x9;&#x9;instance.setUserValueOf('ParmValue5',&#x9;additionalParmValue5.value);#EOL#&#x9;&#x9;instance.setUserValueOf('URL',&#x9;&#x9;&#x9;url.value);#EOL##EOL#&#x9;} else {#EOL#&#x9;&#x9;break;#EOL#&#x9;}#EOL#}" SubsystemID="Z" Type="XF000"/><MaintenanceLog Descriptions="・ZT021を追加して、DB設定に追加した#EOL#・DB接続文字列からポート指定(:50000)をはずした" Headder="1.0.6" ID="5" SortKey="20160621"/><MaintenanceLog Descriptions="･「ZF090 パージ処理の起動」と「ZF900 セッション履歴パージ処理」を改善した#EOL#･WEBサービス検証用プログラム(ZFWEBTEST)の使い勝手を改善した#EOL#" Headder="1.0.7" ID="6" SortKey="20160829"/><Function ID="ZF910" Name="セッション履歴パージ処理" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rZT050; var dZT050; var dZT051;#EOL#var limitDate = instance.parmMap.get('LIMIT_DATE');#EOL#var countZT050_Deleted = 0; var countZT050_ToBeDeleted = 0; var countZT051_Deleted = 0;#EOL#var count = 0;#EOL##EOL#//////////////////////////#EOL#// 削除結果省略値の登録 //#EOL#//////////////////////////#EOL#instance.returnMap.put('ZT050_COUNT', -1);#EOL#instance.returnMap.put('ZT051_COUNT', -1);#EOL##EOL#/////////////////////////////////////////////#EOL#// セッション(ZT050)削除対象レコードの検索 //#EOL#/////////////////////////////////////////////#EOL#rZT050 = instance.createTableOperator('Select', 'ZT050');#EOL#rZT050.setSelectFields('NRSESSION');#EOL#rZT050.addKeyValue('DTLOGIN &lt;=',&#x9;limitDate + ' 23:59:59.999');#EOL#while (rZT050.next()) {#EOL#&#x9;countZT050_ToBeDeleted++;#EOL##EOL#&#x9;////////////////////////////////#EOL#&#x9;// 現セッションであればエラー //#EOL#&#x9;////////////////////////////////#EOL#&#x9;if (rZT050.getValueOf('NRSESSION') == session.sessionID) {#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', '現セッションが削除対象に含まれていたため、処理はキャンセルされました。');#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '99');#EOL#&#x9;&#x9;break;#EOL##EOL#&#x9;} else {#EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;// セッション明細(ZT051)の削除 //#EOL#&#x9;&#x9;/////////////////////////////////#EOL#&#x9;&#x9;dZT051 = instance.createTableOperator('Delete', 'ZT051');#EOL#&#x9;&#x9;dZT051.addKeyValue('NRSESSION',&#x9;rZT050.getValueOf('NRSESSION'));#EOL#&#x9;&#x9;count = dZT051.execute();#EOL#&#x9;&#x9;countZT051_Deleted = Number(countZT051_Deleted) + Number(count);#EOL##EOL#&#x9;&#x9;/////////////////////////////#EOL#&#x9;&#x9;// セッション(ZT050)の削除 //#EOL#&#x9;&#x9;/////////////////////////////#EOL#&#x9;&#x9;dZT050 = instance.createTableOperator('Delete', 'ZT050');#EOL#&#x9;&#x9;dZT050.addKeyValue('NRSESSION',&#x9;rZT050.getValueOf('NRSESSION'));#EOL#&#x9;&#x9;count = dZT050.execute();#EOL#&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;countZT050_Deleted++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////#EOL#// 削除結果の登録 //#EOL#////////////////////#EOL#if (countZT050_Deleted == countZT050_ToBeDeleted) {#EOL#&#x9;instance.returnMap.put('ZT050_COUNT', countZT050_Deleted);#EOL#&#x9;instance.returnMap.put('ZT051_COUNT', countZT051_Deleted);#EOL#}#EOL#" SubsystemID="Z" Type="XF000"/><Function ID="ZF900" Name="パージ処理の起動" Script="////////////////#EOL#// 変数の定義 //#EOL#////////////////#EOL#var hasError = true; var workCount = 0; var totalCount = 0;#EOL##EOL#////////////////////#EOL#// ダイアログ定義 //#EOL#////////////////////#EOL#var dialog = session.getInputDialog();#EOL#dialog.setMessage('＊チェックされた対象について、上の日付を含めそれ以前の取引日を持つデータをクリアします。処理件数の詳細については、セッション履歴で確認してください。実行前にDBをバックアップすることをお勧めします。');#EOL#dialog.setMessageHeight(140);#EOL#var limitDate = dialog.addField('パージ基準日付', 'ALPHA');#EOL#limitDate.value = '0000/00/00';#EOL#var fgTransactionData = dialog.addField('トランザクションデータ', 'CHECKBOX');#EOL#fgTransactionData.setValue(false);#EOL#var fgSessionData = dialog.addField('セッション履歴データ', 'CHECKBOX');#EOL#fgSessionData.setValue(false);#EOL##EOL#////////////////////////////////////////////#EOL#// ダイアログ表示と条件にもとづく後続処理 //#EOL#////////////////////////////////////////////#EOL#var reply = dialog.request('パージ処理の条件設定');#EOL#if (reply == 0) {#EOL##EOL#&#x9;////////////////////////#EOL#&#x9;// 日付値の妥当性検査 //#EOL#&#x9;////////////////////////#EOL#&#x9;var date = limitDate.value + '';#EOL#&#x9;if (date.length == 10) {#EOL#&#x9;&#x9;var year = date.substr(0, 4);#EOL#&#x9;&#x9;var month = date.substr(5, 2);#EOL#&#x9;&#x9;var day = date.substr(8, 2);#EOL#&#x9;&#x9;date = new Date(year, month-1, day);#EOL#&#x9;&#x9;if (date.getFullYear()==year &amp;&amp; date.getMonth()==month-1 &amp;&amp; date.getDate()==day) {#EOL#&#x9;&#x9;&#x9;hasError = false;#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;// パラメータのセット //#EOL#&#x9;&#x9;&#x9;////////////////////////#EOL#&#x9;&#x9;&#x9;instance.parmMap.put('LIMIT_DATE', year + '-' + month + '-' + day);#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;if (hasError) {#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', '基準日付('+ limitDate.value + ')が正しくありません。処理はキャンセルされました。');#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_CODE', '99');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;// トランザクションデータのパージ //#EOL#&#x9;&#x9;////////////////////////////////////#EOL#&#x9;&#x9;if (fgTransactionData.value == true) {#EOL#&#x9;&#x9;&#x9;purgeTransactionData();#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;// セッションデータのパージ //#EOL#&#x9;&#x9;//////////////////////////////#EOL#&#x9;&#x9;if (fgSessionData.value == true) {#EOL#&#x9;&#x9;&#x9;purgeSessionData();#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;//////////////#EOL#&#x9;&#x9;// 終了処理 //#EOL#&#x9;&#x9;//////////////#EOL#&#x9;&#x9;if (fgTransactionData.value == true || fgSessionData.value == true) {#EOL#&#x9;&#x9;&#x9;finalization();#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL##EOL#} else {#EOL#&#x9;instance.returnMap.put('RETURN_MESSAGE', '＊処理は取り消されました。');#EOL#}#EOL##EOL#//////////////////////////#EOL#// 取引実績のパージ処理 //#EOL#//////////////////////////#EOL#function purgeTransactionData() {#EOL##EOL#//&#x9;if (!hasError) {#EOL#//&#x9;&#x9;instance.callFunction('CF900'); // 売上データ管理／パージ処理 //#EOL#//&#x9;&#x9;summarizeCountOfDeleted('CT020');#EOL#//&#x9;&#x9;summarizeCountOfDeleted('CT021');#EOL#//&#x9;&#x9;summarizeCountOfDeleted('CT022');#EOL#//&#x9;}#EOL#//#EOL#//&#x9;if (!hasError) {#EOL#//&#x9;&#x9;instance.callFunction('CF990'); // 売上実績パージ処理 //#EOL#//&#x9;&#x9;summarizeCountOfDeleted('CT100');#EOL#//&#x9;}#EOL#}#EOL##EOL#////////////////////////////////#EOL#// セッション履歴のパージ処理 //#EOL#////////////////////////////////#EOL#function purgeSessionData() {#EOL#&#x9;if (!hasError) {#EOL#&#x9;&#x9;instance.callFunction('ZF910'); // セッション履歴パージ処理 //#EOL#&#x9;&#x9;summarizeCountOfDeleted('ZT050');#EOL#&#x9;&#x9;summarizeCountOfDeleted('ZT051');#EOL#&#x9;}#EOL#}#EOL##EOL#//////////////#EOL#// 終了処理 //#EOL#//////////////#EOL#function finalization() {#EOL##EOL#&#x9;if (hasError) {#EOL#&#x9;&#x9;instance.rollback();#EOL#&#x9;&#x9;instance.cancelWithMessage('＊パージ処理に失敗しました。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;if (fgTransactionData.value == true) {#EOL#//&#x9;&#x9;&#x9;session.compressTable('CT020');#EOL#//&#x9;&#x9;&#x9;instance.setProcessLog('CT020 compressed.');#EOL#//&#x9;&#x9;&#x9;session.compressTable('CT021');#EOL#//&#x9;&#x9;&#x9;instance.setProcessLog('CT021 compressed.');#EOL#//&#x9;&#x9;&#x9;session.compressTable('CT022');#EOL#//&#x9;&#x9;&#x9;instance.setProcessLog('CT022 compressed.');#EOL#//&#x9;&#x9;&#x9;session.compressTable('CT100');#EOL#//&#x9;&#x9;&#x9;instance.setProcessLog('CT100 compressed.');#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;if (fgSessionData.value == true) {#EOL#&#x9;&#x9;&#x9;session.compressTable('ZT050');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('ZT050 compressed.');#EOL#&#x9;&#x9;&#x9;session.compressTable('ZT051');#EOL#&#x9;&#x9;&#x9;instance.setProcessLog('ZT051 compressed.');#EOL#&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;instance.commit();#EOL#&#x9;&#x9;instance.setProcessLog('削除／コンプレス処理がコミットされました。');#EOL#&#x9;&#x9;var message = '＊パージ処理が完了しました。合計' + totalCount + 'レコードが削除されました。';#EOL#&#x9;&#x9;instance.returnMap.put('RETURN_MESSAGE', message);#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////#EOL#// 内部関数：テーブル別削除件数の処理 //#EOL#////////////////////////////////////////#EOL#function summarizeCountOfDeleted(tableID) {#EOL#&#x9;workCount = parseInt(instance.returnMap.get(tableID + '_COUNT'));#EOL#&#x9;if (workCount == -1) {#EOL#&#x9;&#x9;hasError = true;#EOL#&#x9;&#x9;instance.setProcessLog(tableID + 'のレコード削除に失敗しました');#EOL#&#x9;} else {#EOL#&#x9;&#x9;instance.setProcessLog(tableID + 'の' + workCount + '件が削除されました');#EOL#&#x9;&#x9;totalCount = totalCount + workCount;#EOL#&#x9;}#EOL#}" SubsystemID="Z" Type="XF000"/><Function ID="AF200X" Name="組織情報処理用WEBサービス(XML)" Script="///////////////////////////////////////////////////////////////////////////////////////////////#EOL#//                        　　組織情報を得るためのWEBサービス                                //#EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#// REQUEST_TYPE : 処理内容                                                                   //#EOL#//-------------------------------------------------------------------------------------------//#EOL#// ListSections     : 部門の一覧を返す                                                       //#EOL#// InquireSection   : 部門コード(Code)指定で部門の詳細情報を返す                             //#EOL#// ListMembers      : 従業員の一覧を返す                                                     //#EOL#// InquireMember    : 従業員№(Number)指定で従業員の詳細情報を返す                           //#EOL#// GetMemberSection : 従業員№(Number)と日付(Date)指定でその日における従業員の所属部門を返す //#EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#var isValidMethod = false;#EOL##EOL#/////////////////////////////////////#EOL#// 返信用XMLオブジェクトを構築する //#EOL#/////////////////////////////////////#EOL#var xmlDocResult = session.createXmlDocument('Result');#EOL#var rootNodeResult = xmlDocResult.getFirstChild();#EOL##EOL#/////////////////////////////////////#EOL#// ListSections : 部門の一覧を返す //#EOL#/////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'ListSections') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////////////////#EOL#&#x9;// 検索して返信データを設定する //#EOL#&#x9;//////////////////////////////////#EOL#&#x9;var count = 0;#EOL#&#x9;var eAT010 = instance.createTableEvaluator('AT010');#EOL#&#x9;while (eAT010.next()) {#EOL#&#x9;&#x9;var section = session.createXmlNode(xmlDocResult, 'Section');#EOL#&#x9;&#x9;section.setAttribute('CDBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_CDBUMON')); //部門C#EOL#&#x9;&#x9;section.setAttribute('TXBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_TXBUMON')); //部門名#EOL#&#x9;&#x9;section.setAttribute('NRKANRISYA',&#x9;eAT010.getValueOf('AT010_NRKANRISYA')); //管理者№#EOL#&#x9;&#x9;section.setAttribute('TXKANRISYA',&#x9;eAT010.getValueOf('AT020_TXKANJI')); //管理者名#EOL#&#x9;&#x9;rootNodeResult.appendChild(section);#EOL#&#x9;&#x9;count++;#EOL#&#x9;}#EOL#&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;rootNodeResult.setAttribute('Message',&#x9;count + '件の部門が見つかりました。');#EOL#}#EOL##EOL#/////////////////////////////////////////////////////////////////#EOL#// InquireSection : 部門コード(Code)指定で部門の詳細情報を返す //#EOL#/////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'InquireSection') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// パラメータの確認 //#EOL#&#x9;//////////////////////#EOL#&#x9;if (instance.parmMap.get('Code') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'部門コード(Code)が指定されていません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;// 部門データを検索して返信データを設定する //#EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;var eAT010 = instance.createTableEvaluator('AT010');#EOL#&#x9;&#x9;eAT010.addKeyValue('CDBUMON',&#x9;instance.parmMap.get('Code'));#EOL#&#x9;&#x9;if (eAT010.next()) {#EOL#&#x9;&#x9;&#x9;var section = session.createXmlNode(xmlDocResult, 'Section');#EOL#&#x9;&#x9;&#x9;section.setAttribute('CDBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_CDBUMON')); //部門C#EOL#&#x9;&#x9;&#x9;section.setAttribute('TXBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_TXBUMON')); //部門名#EOL#&#x9;&#x9;&#x9;section.setAttribute('TXTEKIYO',&#x9;eAT010.getValueOf('AT010_TXTEKIYO')); //摘要#EOL#&#x9;&#x9;&#x9;section.setAttribute('NRKANRISYA',&#x9;eAT010.getValueOf('AT010_NRKANRISYA')); //管理者№#EOL#&#x9;&#x9;&#x9;section.setAttribute('TXKANRISYA',&#x9;eAT010.getValueOf('AT020_TXKANJI')); //管理者名#EOL#&#x9;&#x9;&#x9;rootNodeResult.appendChild(section);#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'部門データが検索されました。');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'指定の部門コード(' + instance.parmMap.get('Code') + ')を持つ部門データが見つかりません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////#EOL#// ListMembers : （現時点で退職していない）従業員の一覧を返す //#EOL#////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'ListMembers') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 処理日オブジェクトの構築 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;var dateString = session.today + '';#EOL#&#x9;var dateToday = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL##EOL#&#x9;//////////////////////////////////#EOL#&#x9;// 検索して返信データを設定する //#EOL#&#x9;//////////////////////////////////#EOL#&#x9;var count = 0;#EOL#&#x9;var eAT020 = instance.createTableEvaluator('AT020');#EOL#&#x9;while (eAT020.next()) {#EOL##EOL#&#x9;&#x9;//////////////////////////////////////////////////#EOL#&#x9;&#x9;// 処理日において退職していなければリストに登録 //#EOL#&#x9;&#x9;//////////////////////////////////////////////////#EOL#&#x9;&#x9;dateString = '9999-12-31';#EOL#&#x9;&#x9;if (eAT020.getValueOf('AT020_DTTAISYA') != '') {#EOL#&#x9;&#x9;&#x9;dateString = eAT020.getValueOf('AT020_DTTAISYA') + '';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;dateResigned = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL#&#x9;&#x9;diff = dateResigned.getTime() - dateToday.getTime();#EOL#&#x9;&#x9;if (diff >= 0) {#EOL#&#x9;&#x9;&#x9;member = session.createXmlNode(xmlDocResult, 'Member');#EOL#&#x9;&#x9;&#x9;member.setAttribute('NRJYUGYOIN',&#x9;eAT020.getValueOf('AT020_NRJYUGYOIN')); //従業員№#EOL#&#x9;&#x9;&#x9;member.setAttribute('TXKANA',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANA')); //カナ名#EOL#&#x9;&#x9;&#x9;member.setAttribute('TXKANJI',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANJI')); //漢字名#EOL#&#x9;&#x9;&#x9;member.setAttribute('KBKOYOU',&#x9;&#x9;eAT020.getValueOf('AT020_KBKOYOU')); //雇用区分#EOL#&#x9;&#x9;&#x9;member.setAttribute('TXKOYOU',&#x9;&#x9;session.getUserVariantDescription('KBKOYOU', eAT020.getValueOf('AT020_KBKOYOU'))); //雇用区分名#EOL#&#x9;&#x9;&#x9;rootNodeResult.appendChild(member);#EOL#&#x9;&#x9;&#x9;count++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;rootNodeResult.setAttribute('Message',&#x9;count + '件の従業員が見つかりました。');#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////#EOL#// InquireMember : 従業員№(Number)指定で従業員の詳細情報を返す //#EOL#//////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'InquireMember') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// パラメータの確認 //#EOL#&#x9;//////////////////////#EOL#&#x9;if (instance.parmMap.get('Number') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'従業員№(Number)が指定されていません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;// 検索して返信データを設定する //#EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;var eAT020 = instance.createTableEvaluator('AT020');#EOL#&#x9;&#x9;eAT020.addKeyValue('NRJYUGYOIN',&#x9;instance.parmMap.get('Number'));#EOL#&#x9;&#x9;if (eAT020.next()) {#EOL#&#x9;&#x9;&#x9;member = session.createXmlNode(xmlDocResult, 'Member');#EOL#&#x9;&#x9;&#x9;member.setAttribute('NRJYUGYOIN',&#x9;eAT020.getValueOf('AT020_NRJYUGYOIN')); //従業員№#EOL#&#x9;&#x9;&#x9;member.setAttribute('TXKANA',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANA')); //カナ名#EOL#&#x9;&#x9;&#x9;member.setAttribute('TXKANJI',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANJI')); //漢字名#EOL#&#x9;&#x9;&#x9;member.setAttribute('KBKOYOU',&#x9;&#x9;eAT020.getValueOf('AT020_KBKOYOU')); //雇用区分#EOL#&#x9;&#x9;&#x9;member.setAttribute('TXKOYOU',&#x9;&#x9;session.getUserVariantDescription('KBKOYOU', eAT020.getValueOf('AT020_KBKOYOU'))); //雇用区分名#EOL#&#x9;&#x9;&#x9;member.setAttribute('DTNYUSYA',&#x9;&#x9;eAT020.getValueOf('AT020_DTNYUSYA')); //入社日#EOL#&#x9;&#x9;&#x9;member.setAttribute('DTTAISYA',&#x9;&#x9;eAT020.getValueOf('AT020_DTTAISYA')); //退社日#EOL#&#x9;&#x9;&#x9;member.setAttribute('CDBUMON',&#x9;&#x9;eAT020.getValueOf('AT020_CDBUMON')); //現所属部門C#EOL#&#x9;&#x9;&#x9;member.setAttribute('TXBUMON',&#x9;&#x9;eAT020.getValueOf('AT010CUR_TXBUMON')); //現所属部門名#EOL#&#x9;&#x9;&#x9;rootNodeResult.appendChild(member);#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'従業員が見つかりました。');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'指定の従業員№(' + instance.parmMap.get('Number') + ')を持つ従業員データが見つかりません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#// GetMemberSection : 従業員№(Number)と日付(Date)指定でその日における従業員の所属部門を返す //#EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'GetMemberSection') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// パラメータの確認 //#EOL#&#x9;//////////////////////#EOL#&#x9;if (instance.parmMap.get('Number') == null || instance.parmMap.get('Date') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'従業員№(Number)か日付(Date)が指定されていません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;////////////////////////////////////////#EOL#&#x9;&#x9;// 指定日における所属部門コードを得る //#EOL#&#x9;&#x9;////////////////////////////////////////#EOL#&#x9;&#x9;var cdBumon = getSyozokuSoshiki(instance.parmMap.get('Number'), instance.parmMap.get('Date') + '');#EOL##EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;// 部門データを検索して返信データを設定する //#EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;var eAT010 = instance.createTableEvaluator('AT010');#EOL#&#x9;&#x9;eAT010.addKeyValue('CDBUMON',&#x9;cdBumon);#EOL#&#x9;&#x9;if (eAT010.next()) {#EOL#&#x9;&#x9;&#x9;var section = session.createXmlNode(xmlDocResult, 'Section');#EOL#&#x9;&#x9;&#x9;section.setAttribute('CDBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_CDBUMON')); //部門C#EOL#&#x9;&#x9;&#x9;section.setAttribute('TXBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_TXBUMON')); //部門名#EOL#&#x9;&#x9;&#x9;section.setAttribute('TXTEKIYO',&#x9;eAT010.getValueOf('AT010_TXTEKIYO')); //摘要#EOL#&#x9;&#x9;&#x9;section.setAttribute('NRKANRISYA',&#x9;eAT010.getValueOf('AT010_NRKANRISYA')); //管理者№#EOL#&#x9;&#x9;&#x9;section.setAttribute('TXKANRISYA',&#x9;eAT010.getValueOf('AT020_TXKANJI')); //管理者名#EOL#&#x9;&#x9;&#x9;rootNodeResult.appendChild(section);#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'部門データが検索されました。');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'有効な部門データが見つかりません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////////////////#EOL#// 無効なリクエストタイプが要求された場合はエラー //#EOL#////////////////////////////////////////////////////#EOL#if (!isValidMethod) {#EOL#&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;rootNodeResult.setAttribute('Message',&#x9;'指定されたリクエストタイプ(' + instance.parmMap.get('REQUEST_TYPE') + ')は無効です。');#EOL#}#EOL##EOL#///////////////////////////////////////#EOL#// XMLドキュメントを応答にセットする //#EOL#///////////////////////////////////////#EOL#instance.returnMap.put('RESULT', xmlDocResult);" SubsystemID="A" Type="XF000"/><Function ID="AF200J" Name="組織情報処理用WEBサービス(JSON)" Script="///////////////////////////////////////////////////////////////////////////////////////////////#EOL#//                        　　組織情報を得るためのWEBサービス                                //#EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#// REQUEST_TYPE : 処理内容                                                                   //#EOL#//-------------------------------------------------------------------------------------------//#EOL#// ListSections     : 部門の一覧を返す                                                       //#EOL#// InquireSection   : 部門コード(Code)指定で部門の詳細情報を返す                             //#EOL#// ListMembers      : 従業員の一覧を返す                                                     //#EOL#// InquireMember    : 従業員№(Number)指定で従業員の詳細情報を返す                           //#EOL#// GetMemberSection : 従業員№(Number)と日付(Date)指定でその日における従業員の所属部門を返す //#EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#var isValidMethod = false;#EOL##EOL#//////////////////////////////////////#EOL#// 返信用JSONオブジェクトを構築する //#EOL#//////////////////////////////////////#EOL#var jsonResult = session.createJsonObject();#EOL##EOL#/////////////////////////////////////#EOL#// ListSections : 部門の一覧を返す //#EOL#/////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'ListSections') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////////////////#EOL#&#x9;// 検索して返信データを設定する //#EOL#&#x9;//////////////////////////////////#EOL#&#x9;var sectionArray = session.createJsonArray();#EOL#&#x9;var count = 0;#EOL#&#x9;var eAT010 = instance.createTableEvaluator('AT010');#EOL#&#x9;while (eAT010.next()) {#EOL#&#x9;&#x9;var section = session.createJsonObject();#EOL#&#x9;&#x9;section.put('CDBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_CDBUMON')); //部門C#EOL#&#x9;&#x9;section.put('TXBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_TXBUMON')); //部門名#EOL#&#x9;&#x9;section.put('NRKANRISYA',&#x9;eAT010.getValueOf('AT010_NRKANRISYA')); //管理者№#EOL#&#x9;&#x9;section.put('TXKANRISYA',&#x9;eAT010.getValueOf('AT020_TXKANJI')); //管理者名#EOL#&#x9;&#x9;sectionArray.put(section);#EOL#&#x9;&#x9;count++;#EOL#&#x9;}#EOL#&#x9;jsonResult.put('Section',&#x9;sectionArray);#EOL#&#x9;jsonResult.put('Status',&#x9;'OK');#EOL#&#x9;jsonResult.put('Message',&#x9;count + '件の部門データが見つかりました。');#EOL#}#EOL##EOL#/////////////////////////////////////////////////////////////////#EOL#// InquireSection : 部門コード(Code)指定で部門の詳細情報を返す //#EOL#/////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'InquireSection') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// パラメータの確認 //#EOL#&#x9;//////////////////////#EOL#&#x9;if (instance.parmMap.get('Code') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'部門コード(Code)が指定されていません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;// 部門データを検索して返信データを設定する //#EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;var eAT010 = instance.createTableEvaluator('AT010');#EOL#&#x9;&#x9;eAT010.addKeyValue('CDBUMON',&#x9;instance.parmMap.get('Code'));#EOL#&#x9;&#x9;if (eAT010.next()) {#EOL#&#x9;&#x9;&#x9;var section = session.createJsonObject();#EOL#&#x9;&#x9;&#x9;section.put('CDBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_CDBUMON')); //部門C#EOL#&#x9;&#x9;&#x9;section.put('TXBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_TXBUMON')); //部門名#EOL#&#x9;&#x9;&#x9;section.put('TXTEKIYO',&#x9;&#x9;eAT010.getValueOf('AT010_TXTEKIYO')); //摘要#EOL#&#x9;&#x9;&#x9;section.put('NRKANRISYA',&#x9;eAT010.getValueOf('AT010_NRKANRISYA')); //管理者№#EOL#&#x9;&#x9;&#x9;section.put('TXKANRISYA',&#x9;eAT010.getValueOf('AT020_TXKANJI')); //管理者名#EOL#&#x9;&#x9;&#x9;jsonResult.put('Section',&#x9;section);#EOL#&#x9;&#x9;&#x9;jsonResult.put('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;jsonResult.put('Message',&#x9;'部門データが検索されました。');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;jsonResult.put('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;jsonResult.put('Message',&#x9;'指定の部門コード(' + instance.parmMap.get('Code') + ')を持つ部門データが見つかりません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////#EOL#// ListMembers : （現時点で退職していない）従業員の一覧を返す //#EOL#////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'ListMembers') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////////////#EOL#&#x9;// 処理日オブジェクトの構築 //#EOL#&#x9;//////////////////////////////#EOL#&#x9;var dateString = session.today + '';#EOL#&#x9;var dateToday = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL##EOL#&#x9;//////////////////////////////////#EOL#&#x9;// 検索して返信データを設定する //#EOL#&#x9;//////////////////////////////////#EOL#&#x9;var memberArray = session.createJsonArray();#EOL#&#x9;var count = 0;#EOL#&#x9;var eAT020 = instance.createTableEvaluator('AT020');#EOL#&#x9;while (eAT020.next()) {#EOL##EOL#&#x9;&#x9;//////////////////////////////////////////////////#EOL#&#x9;&#x9;// 処理日において退職していなければリストに登録 //#EOL#&#x9;&#x9;//////////////////////////////////////////////////#EOL#&#x9;&#x9;dateString = '9999-12-31';#EOL#&#x9;&#x9;if (eAT020.getValueOf('AT020_DTTAISYA') != '') {#EOL#&#x9;&#x9;&#x9;dateString = eAT020.getValueOf('AT020_DTTAISYA') + '';#EOL#&#x9;&#x9;}#EOL#&#x9;&#x9;dateResigned = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL#&#x9;&#x9;diff = dateResigned.getTime() - dateToday.getTime();#EOL#&#x9;&#x9;if (diff >= 0) {#EOL#&#x9;&#x9;&#x9;var member = session.createJsonObject();#EOL#&#x9;&#x9;&#x9;member.put('NRJYUGYOIN',&#x9;eAT020.getValueOf('AT020_NRJYUGYOIN')); //従業員№#EOL#&#x9;&#x9;&#x9;member.put('TXKANA',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANA')); //カナ名#EOL#&#x9;&#x9;&#x9;member.put('TXKANJI',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANJI')); //漢字名#EOL#&#x9;&#x9;&#x9;member.put('KBKOYOU',&#x9;&#x9;eAT020.getValueOf('AT020_KBKOYOU')); //雇用区分#EOL#&#x9;&#x9;&#x9;member.put('TXKOYOU',&#x9;&#x9;session.getUserVariantDescription('KBKOYOU', eAT020.getValueOf('AT020_KBKOYOU'))); //雇用区分名#EOL#&#x9;&#x9;&#x9;memberArray.put(member);#EOL#&#x9;&#x9;&#x9;count++;#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#&#x9;jsonResult.put('Section',&#x9;memberArray);#EOL#&#x9;jsonResult.put('Status',&#x9;'OK');#EOL#&#x9;jsonResult.put('Message',&#x9;count + '件の従業員データが見つかりました。');#EOL#}#EOL##EOL#//////////////////////////////////////////////////////////////////#EOL#// InquireMember : 従業員№(Number)指定で従業員の詳細情報を返す //#EOL#//////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'InquireMember') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// パラメータの確認 //#EOL#&#x9;//////////////////////#EOL#&#x9;if (instance.parmMap.get('Number') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'従業員№(Number)が指定されていません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;// 検索して返信データを設定する //#EOL#&#x9;&#x9;//////////////////////////////////#EOL#&#x9;&#x9;var eAT020 = instance.createTableEvaluator('AT020');#EOL#&#x9;&#x9;eAT020.addKeyValue('NRJYUGYOIN',&#x9;instance.parmMap.get('Number'));#EOL#&#x9;&#x9;if (eAT020.next()) {#EOL#&#x9;&#x9;&#x9;var member = session.createJsonObject();#EOL#&#x9;&#x9;&#x9;member.put('NRJYUGYOIN',&#x9;eAT020.getValueOf('AT020_NRJYUGYOIN')); //従業員№#EOL#&#x9;&#x9;&#x9;member.put('TXKANA',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANA')); //カナ名#EOL#&#x9;&#x9;&#x9;member.put('TXKANJI',&#x9;&#x9;eAT020.getValueOf('AT020_TXKANJI')); //漢字名#EOL#&#x9;&#x9;&#x9;member.put('KBKOYOU',&#x9;&#x9;eAT020.getValueOf('AT020_KBKOYOU')); //雇用区分#EOL#&#x9;&#x9;&#x9;member.put('TXKOYOU',&#x9;&#x9;session.getUserVariantDescription('KBKOYOU', eAT020.getValueOf('AT020_KBKOYOU'))); //雇用区分名#EOL#&#x9;&#x9;&#x9;member.put('DTNYUSYA',&#x9;&#x9;eAT020.getValueOf('AT020_DTNYUSYA')); //入社日#EOL#&#x9;&#x9;&#x9;member.put('DTTAISYA',&#x9;&#x9;eAT020.getValueOf('AT020_DTTAISYA')); //退社日#EOL#&#x9;&#x9;&#x9;member.put('CDBUMON',&#x9;&#x9;eAT020.getValueOf('AT020_CDBUMON')); //現所属部門C#EOL#&#x9;&#x9;&#x9;member.put('TXBUMON',&#x9;&#x9;eAT020.getValueOf('AT010CUR_TXBUMON')); //現所属部門名#EOL#&#x9;&#x9;&#x9;jsonResult.put('Member',&#x9;member);#EOL#&#x9;&#x9;&#x9;jsonResult.put('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;jsonResult.put('Message',&#x9;'従業員データが検索されました。');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;jsonResult.put('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;jsonResult.put('Message',&#x9;'指定の従業員№(' + instance.parmMap.get('Number') + ')を持つ従業員データが見つかりません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#// GetMemberSection : 従業員№(Number)と日付(Date)指定でその日における従業員の所属部門を返す //#EOL#///////////////////////////////////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'GetMemberSection') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////#EOL#&#x9;// パラメータの確認 //#EOL#&#x9;//////////////////////#EOL#&#x9;if (instance.parmMap.get('Number') == null || instance.parmMap.get('Date') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'従業員№(Number)か日付(Date)が指定されていません。');#EOL#&#x9;} else {#EOL##EOL#&#x9;&#x9;////////////////////////////////////////#EOL#&#x9;&#x9;// 指定日における所属部門コードを得る //#EOL#&#x9;&#x9;////////////////////////////////////////#EOL#&#x9;&#x9;var cdBumon = getSyozokuSoshiki(instance.parmMap.get('Number'), instance.parmMap.get('Date') + '');#EOL##EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;// 部門データを検索して返信データを設定する //#EOL#&#x9;&#x9;//////////////////////////////////////////////#EOL#&#x9;&#x9;var eAT010 = instance.createTableEvaluator('AT010');#EOL#&#x9;&#x9;eAT010.addKeyValue('CDBUMON',&#x9;cdBumon);#EOL#&#x9;&#x9;if (eAT010.next()) {#EOL#&#x9;&#x9;&#x9;var section = session.createJsonObject();#EOL#&#x9;&#x9;&#x9;section.put('CDBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_CDBUMON')); //部門C#EOL#&#x9;&#x9;&#x9;section.put('TXBUMON',&#x9;&#x9;eAT010.getValueOf('AT010_TXBUMON')); //部門名#EOL#&#x9;&#x9;&#x9;section.put('TXTEKIYO',&#x9;&#x9;eAT010.getValueOf('AT010_TXTEKIYO')); //摘要#EOL#&#x9;&#x9;&#x9;section.put('NRKANRISYA',&#x9;eAT010.getValueOf('AT010_NRKANRISYA')); //管理者№#EOL#&#x9;&#x9;&#x9;section.put('TXKANRISYA',&#x9;eAT010.getValueOf('AT020_TXKANJI')); //管理者名#EOL#&#x9;&#x9;&#x9;jsonResult.put('Section',&#x9;section);#EOL#&#x9;&#x9;&#x9;jsonResult.put('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;jsonResult.put('Message',&#x9;'部門データが検索されました。');#EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;jsonResult.put('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;jsonResult.put('Message',&#x9;'有効な部門データが見つかりません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////////////////#EOL#// 無効なリクエストタイプが要求された場合はエラー //#EOL#////////////////////////////////////////////////////#EOL#if (!isValidMethod) {#EOL#&#x9;jsonResult.put('Status',&#x9;'ERROR');#EOL#&#x9;jsonResult.put('Message',&#x9;'指定されたリクエストタイプ(' + instance.parmMap.get('REQUEST_TYPE') + ')は無効です。');#EOL#}#EOL##EOL#///////////////////////////////////////#EOL#// XMLドキュメントを応答にセットする //#EOL#///////////////////////////////////////#EOL#instance.returnMap.put('RESULT', jsonResult);" SubsystemID="A" Type="XF000"/><Function ID="ZF200" Name="パスワード処理用WEBサービス" Script="/////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#//                 特定ユーザのパスワードを認証、再設定、変更するためのWEBサービス                     //#EOL#/////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#// REQUEST_TYPE   : 処理内容                                                                           //#EOL#//-----------------------------------------------------------------------------------------------------//#EOL#// CheckPassword  : ユーザID(ID)とパスワード(Password)でユーザ認証した結果を返す                       //#EOL#// ResetPassword  : ユーザ(ID)のパスワードを再設定してユーザのメアドに通知する                         //#EOL#// ChangePassword : ユーザ(ID)と現行パスワード(OldPassword)で、新しいパスワード(NewPassword)に変更する //#EOL#/////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#var isValidMethod = false;#EOL##EOL#/////////////////////////////////#EOL#// 返信用XMLオブジェクトの構築 //#EOL#/////////////////////////////////#EOL#var xmlDocResult = session.createXmlDocument('Result');#EOL#var rootNodeResult = xmlDocResult.getFirstChild();#EOL##EOL#//////////////////////////////#EOL#// 処理日オブジェクトの構築 //#EOL#//////////////////////////////#EOL#var dateString = session.today + '';#EOL#var dateToday = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL##EOL#///////////////////////////////////////////////////////////////////////////////////#EOL#// CheckPassword  : ユーザID(ID)とパスワード(Password)でユーザ認証した結果を返す //#EOL#///////////////////////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'CheckPassword') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// パラメータのチェック //#EOL#&#x9;//////////////////////////#EOL#&#x9;if (instance.parmMap.get('ID') == null || instance.parmMap.get('Password') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザID(ID)かパスワード(Password)が指定されていません。');#EOL##EOL#&#x9;} else {#EOL#&#x9;&#x9;if (instance.parmMap.get('ID').indexOf(' ') != -1 || instance.parmMap.get('Password').indexOf(' ') != -1) {#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザID(ID)かパスワード(Password)が正しくありません。');#EOL##EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;//////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// ユーザ情報を検索してパスワードをチェックする //#EOL#&#x9;&#x9;&#x9;//////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;var rZT020 = instance.createTableOperator('Select', 'ZT020');#EOL#&#x9;&#x9;&#x9;rZT020.addKeyValue('IDUSER',&#x9;&#x9;instance.parmMap.get('ID'));#EOL#&#x9;&#x9;&#x9;rZT020.addKeyValue('TXPASSWORD',&#x9;session.getDigestedValue(instance.parmMap.get('Password')));#EOL#&#x9;&#x9;&#x9;if (rZT020.next()) {#EOL##EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;// 処理日において失効していなければ認可 //#EOL#&#x9;&#x9;&#x9;&#x9;//////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;&#x9;dateString = rZT020.getValueOf('DTEXPIRE') + '';#EOL#&#x9;&#x9;&#x9;&#x9;dateExpire = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL#&#x9;&#x9;&#x9;&#x9;diff = dateExpire.getTime() - dateToday.getTime();#EOL#&#x9;&#x9;&#x9;&#x9;if (diff > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザとして認証されました。');#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザ定義が既に失効しています。');#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザID(ID)かパスワード(Password)が正しくありません。');#EOL#&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////////////////////////////////////////////#EOL#// ResetPassword : ユーザ(ID)のパスワードを再設定してユーザのメアドに通知する //#EOL#////////////////////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'ResetPassword') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// パラメータのチェック //#EOL#&#x9;//////////////////////////#EOL#&#x9;if (instance.parmMap.get('ID') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザID(ID)が指定されていません。');#EOL##EOL#&#x9;} else {#EOL#&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;// ユーザ情報を検索する //#EOL#&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;var rZT020 = instance.createTableOperator('Select', 'ZT020');#EOL#&#x9;&#x9;rZT020.addKeyValue('IDUSER',&#x9;&#x9;instance.parmMap.get('ID'));#EOL#&#x9;&#x9;if (rZT020.next()) {#EOL##EOL#&#x9;&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 処理日において失効していなければパスワードを再設定する //#EOL#&#x9;&#x9;&#x9;////////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;dateString = rZT020.getValueOf('DTEXPIRE') + '';#EOL#&#x9;&#x9;&#x9;dateExpire = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL#&#x9;&#x9;&#x9;diff = dateExpire.getTime() - dateToday.getTime();#EOL#&#x9;&#x9;&#x9;if (diff > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;var newValue = session.getRandomString(7, 'abcdefghjkmnpqrstuvwxyz23456789')#EOL#&#x9;&#x9;&#x9;&#x9;var newValueDigested = session.getDigestedValue(newValue);#EOL#&#x9;&#x9;&#x9;&#x9;var uZT020 = instance.createTableOperator('Update', 'ZT020');#EOL#&#x9;&#x9;&#x9;&#x9;uZT020.addValue('TXPASSWORD',&#x9;newValueDigested);#EOL#&#x9;&#x9;&#x9;&#x9;uZT020.addKeyValue('IDUSER',&#x9;instance.parmMap.get('ID'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uZT020.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;var addressFrom = session.adminEmail;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;var addressTo = rZT020.getValueOf('TXEMAIL');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;var addressCc = '';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;var subject = '新しいパスワードです。ログインして再設定してください';#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;var message = newValue;#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;session.sendMail(addressFrom, addressTo, addressCc, subject, message, '', '', 'iso-2022-jp');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'パスワードが再設定され、登録されているメールアドレスに通知されました。');#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'パスワードの再設定に失敗しました。再試行してください。');#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザ定義が既に失効しています。');#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザID(ID)かパスワード(Password)が正しくありません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#/////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#// ChangePassword : ユーザ(ID)と現行パスワード(OldPassword)で、新しいパスワード(NewPassword)に変更する //#EOL#/////////////////////////////////////////////////////////////////////////////////////////////////////////#EOL#if (instance.parmMap.get('REQUEST_TYPE') == 'ChangePassword') {#EOL#&#x9;isValidMethod = true;#EOL##EOL#&#x9;//////////////////////////#EOL#&#x9;// パラメータのチェック //#EOL#&#x9;//////////////////////////#EOL#&#x9;if (instance.parmMap.get('ID') == null || instance.parmMap.get('OldPassword') == null || instance.parmMap.get('NewPassword') == null) {#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザID(ID)かパスワード(OldPassword,NewPassword)が指定されていません。');#EOL##EOL#&#x9;} else {#EOL#&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;// ユーザ情報を検索する //#EOL#&#x9;&#x9;//////////////////////////#EOL#&#x9;&#x9;var rZT020 = instance.createTableOperator('Select', 'ZT020');#EOL#&#x9;&#x9;rZT020.addKeyValue('IDUSER',&#x9;&#x9;instance.parmMap.get('ID'));#EOL#&#x9;&#x9;rZT020.addKeyValue('TXPASSWORD',&#x9;session.getDigestedValue(instance.parmMap.get('OldPassword')));#EOL#&#x9;&#x9;if (rZT020.next()) {#EOL##EOL#&#x9;&#x9;&#x9;//////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;// 処理日において失効していなければパスワードを更新する //#EOL#&#x9;&#x9;&#x9;//////////////////////////////////////////////////////////#EOL#&#x9;&#x9;&#x9;dateString = rZT020.getValueOf('DTEXPIRE') + '';#EOL#&#x9;&#x9;&#x9;dateExpire = new Date(dateString.slice(0,4), dateString.slice(5,7) - 1, dateString.slice(8,10));#EOL#&#x9;&#x9;&#x9;diff = dateExpire.getTime() - dateToday.getTime();#EOL#&#x9;&#x9;&#x9;if (diff > 0) {#EOL#&#x9;&#x9;&#x9;&#x9;var newValueDigested = session.getDigestedValue(instance.parmMap.get('NewPassword'));#EOL#&#x9;&#x9;&#x9;&#x9;var uZT020 = instance.createTableOperator('Update', 'ZT020');#EOL#&#x9;&#x9;&#x9;&#x9;uZT020.addValue('TXPASSWORD',&#x9;newValueDigested);#EOL#&#x9;&#x9;&#x9;&#x9;uZT020.addKeyValue('IDUSER',&#x9;instance.parmMap.get('ID'));#EOL#&#x9;&#x9;&#x9;&#x9;count = uZT020.execute();#EOL#&#x9;&#x9;&#x9;&#x9;if (count == 1) {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'OK');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'パスワードが変更されました。');#EOL#&#x9;&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'パスワードの変更に失敗しました。再試行してください。');#EOL#&#x9;&#x9;&#x9;&#x9;}#EOL#&#x9;&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザ定義が既に失効しています。');#EOL#&#x9;&#x9;&#x9;}#EOL##EOL#&#x9;&#x9;} else {#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;&#x9;&#x9;rootNodeResult.setAttribute('Message',&#x9;'ユーザID(ID)か現行パスワード(OldPassword)が正しくありません。');#EOL#&#x9;&#x9;}#EOL#&#x9;}#EOL#}#EOL##EOL#////////////////////////////////////////////////////#EOL#// 無効なリクエストタイプが要求された場合はエラー //#EOL#////////////////////////////////////////////////////#EOL#if (!isValidMethod) {#EOL#&#x9;rootNodeResult.setAttribute('Status',&#x9;'ERROR');#EOL#&#x9;rootNodeResult.setAttribute('Message',&#x9;'指定されたリクエストタイプ(' + instance.parmMap.get('REQUEST_TYPE') + ')は無効です。');#EOL#}#EOL##EOL#///////////////////////////////////////#EOL#// XMLドキュメントを応答にセットする //#EOL#///////////////////////////////////////#EOL#instance.returnMap.put('RESULT', xmlDocResult);" SubsystemID="Z" Type="XF000"/><MaintenanceLog Descriptions="･「ZF090 パージ処理の起動」と「ZF900 セッション履歴パージ処理」のIDをそれぞれZF900,ZF910に変更した#EOL#･軽減税率に対応するために、消費税率(ZT060)と関連機能(ZF060,ZF061)を作り変えた#EOL#･WEBサービス検証用プログラム(ZFWEBTEST)の使い勝手を改善した#EOL#･WEBサービス機能(AF200J,AF200X,ZF200)を追加した" Headder="1.0.8" ID="7" SortKey="20160915"/><Function DetailFunction="PF0110" ID="PF0100" InitialListing="T" InitialMsg="" InitialReadCount="" KeyFields="" Name="音声情報一覧" OrderBy="" PrimaryTable="Ｔ音声情報" Size="AUTO" SubsystemID="P" Type="XF100"><Column DataSource="Ｔ音声情報.ＩＤ" FieldOptions="" Order="0000"/><Column DataSource="Ｔ音声情報.文章" FieldOptions="" Order="0010"/><Column DataSource="Ｔ音声情報.音声ファイル" FieldOptions="" Order="0020"/><Column DataSource="Ｔ音声情報.表示順" FieldOptions="" Order="0030"/><Column DataSource="Ｔ音声情報.摘要" FieldOptions="" Order="0040"/><Filter DataSource="Ｔ音声情報.ＩＤ" FieldOptions="IGNORE_IF_ZERO" Order="0000"/><Filter DataSource="Ｔ音声情報.文章" FieldOptions="" Order="0010"/><Filter DataSource="Ｔ音声情報.音声ファイル" FieldOptions="" Order="0020"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="ADD" Caption="追加" Number="6" Position="2"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/></Function><Function ID="PF0110" InitialMsg="" KeyFields="" Name="音声情報表示・保守" PrimaryTable="Ｔ音声情報" Size="AUTO" SubsystemID="P" Type="XF200"><Field DataSource="Ｔ音声情報.ＩＤ" FieldOptions="" Order="0000"/><Field DataSource="Ｔ音声情報.文章" FieldOptions="" Order="0010"/><Field DataSource="Ｔ音声情報.音声ファイル" FieldOptions="" Order="0020"/><Field DataSource="Ｔ音声情報.表示順" FieldOptions="" Order="0030"/><Field DataSource="Ｔ音声情報.摘要" FieldOptions="" Order="0040"/><Field DataSource="Ｔ音声情報.有効フラグ" FieldOptions="" Order="0050"/><Button Action="EXIT" Caption="閉じる" Number="3" Position="0"/><Button Action="EDIT" Caption="編集" Number="5" Position="2"/><Button Action="COPY" Caption="コピー" Number="7" Position="3"/><Button Action="DELETE" Caption="削除" Number="9" Position="4"/><Button Action="OUTPUT" Caption="出力" Number="12" Position="6"/><Button Action="CALL(PF9998)" Caption="Polly" Number="4" Position="1"/><Button Action="CALL(PF9997)" Caption="再生" Number="11" Position="5"/></Function><Function ID="PF9999" Name="音声合成実行 コマンド実行" Script="// ファイルの読み込み#EOL#function readFile(fname, charset) {#EOL#&#x9;  var Files = java.nio.file.Files;#EOL#&#x9;  var Paths = java.nio.file.Paths;#EOL##EOL#&#x9;  var bytes = Files.readAllBytes(Paths.get(fname));#EOL#&#x9;  var text = new java.lang.String(bytes, charset);#EOL#&#x9;  return &quot;&quot; + text;#EOL#}#EOL##EOL#// ファイルへの保存#EOL#function writeFile(fname, text, charset) {#EOL#&#x9;  var osw = new java.io.OutputStreamWriter(#EOL#&#x9;    new java.io.FileOutputStream(fname),#EOL#&#x9;    charset);#EOL#&#x9;  osw.write(text, 0, text.length);#EOL#&#x9;  osw.close();#EOL#}#EOL##EOL#//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rＴ音声情報;#EOL#var key = session.getAttribute('PFormID');#EOL#// showMessage(key);#EOL#//////////////////////////////////////////////////////////////////#EOL#// 対象期間の売上実績(CT100)の読取と月次取引サマリ(YT010)の更新 //#EOL#//////////////////////////////////////////////////////////////////#EOL#rＴ音声情報 = instance.createTableOperator('Select', 'Ｔ音声情報');#EOL#rＴ音声情報.addKeyValue('ＩＤ', key);#EOL#var myPath = session.fileFolder;#EOL#while (rＴ音声情報.next()) {#EOL##EOL#&#x9;////////////////////////////////////////////#EOL#&#x9;// BREAKならば月次取引サマリ(YT010)の更新 //#EOL#&#x9;////////////////////////////////////////////#EOL#&#x9;var mess = rＴ音声情報.getValueOf('文章');#EOL#&#x9;var filename = rＴ音声情報.getValueOf('音声ファイル');#EOL##EOL#&#x9;var myPath = session.fileFolder;#EOL#&#x9;var awscliPath ='C:\\Program Files\\Amazon\\AWSCLI\\';#EOL##EOL#&#x9;var fname = myPath + &quot;\\data.txt&quot;;#EOL#&#x9;var str = mess;#EOL#//&#x9;var charset = &quot;sjis&quot;;#EOL#    var charset = &quot;utf8&quot;;#EOL# #EOL#//    writeFile(fname, text, charset);#EOL#&#x9;writeFile(fname, str, charset);#EOL##EOL#//&#x9;var cmd1 = 'aws polly synthesize-speech --text &quot;' + mess + '&quot; --voice-id Mizuki --output-format mp3 ' + myPath + '\\' + filename;#EOL#&#x9;cmd1 = 'cmd /c t &quot;' + mess + '&quot;, ' + filename;#EOL##EOL#&#x9;showMessage(cmd1);#EOL#&#x9;instance.setProcessLog(cmd1);#EOL#&#x9;var msg = session.executeProgram(cmd1);#EOL##EOL#&#x9;if (msg != '' ) {#EOL#&#x9;&#x9;    showMessage(&quot;cmd1 実行しました&quot;);#EOL#&#x9;}#EOL#}#EOL##EOL#" SubsystemID="P" Type="XF000"/><Function ID="PF9998" Name="音声合成実行 ruby" Script="// ファイルの読み込み#EOL#function readFile(fname, charset) {#EOL#&#x9;  var Files = java.nio.file.Files;#EOL#&#x9;  var Paths = java.nio.file.Paths;#EOL##EOL#&#x9;  var bytes = Files.readAllBytes(Paths.get(fname));#EOL#&#x9;  var text = new java.lang.String(bytes, charset);#EOL#&#x9;  return &quot;&quot; + text;#EOL#}#EOL##EOL#// ファイルへの保存#EOL#function writeFile(fname, text, charset) {#EOL#&#x9;  var osw = new java.io.OutputStreamWriter(#EOL#&#x9;    new java.io.FileOutputStream(fname),#EOL#&#x9;    charset);#EOL#&#x9;  osw.write(text, 0, text.length);#EOL#&#x9;  osw.close();#EOL#}#EOL##EOL#//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rＴ音声情報;#EOL#var key = session.getAttribute('PFormID');#EOL#// showMessage(key);#EOL#//////////////////////////////////////////////////////////////////#EOL#// 対象期間の売上実績(CT100)の読取と月次取引サマリ(YT010)の更新 //#EOL#//////////////////////////////////////////////////////////////////#EOL#rＴ音声情報 = instance.createTableOperator('Select', 'Ｔ音声情報');#EOL#rＴ音声情報.addKeyValue('ＩＤ', key);#EOL#var myPath = session.fileFolder;#EOL#while (rＴ音声情報.next()) {#EOL##EOL#&#x9;////////////////////////////////////////////#EOL#&#x9;// BREAKならば月次取引サマリ(YT010)の更新 //#EOL#&#x9;////////////////////////////////////////////#EOL#&#x9;var mess = rＴ音声情報.getValueOf('文章');#EOL#&#x9;var filename = rＴ音声情報.getValueOf('音声ファイル');#EOL##EOL#&#x9;var myPath = session.fileFolder;#EOL#&#x9;var awscliPath ='C:\\Program Files\\Amazon\\AWSCLI\\';#EOL##EOL#&#x9;var fname = myPath + &quot;\\data.txt&quot;;#EOL#&#x9;var str = mess;#EOL#&#x9;//&#x9;var charset = &quot;sjis&quot;;#EOL#&#x9;    var charset = &quot;utf8&quot;;#EOL#&#x9; #EOL#&#x9;writeFile(fname, str, charset);#EOL#&#x9;cmd1 = 'cmd /c ruby awspolly.rb ' + filename;#EOL##EOL#//&#x9;showMessage(cmd1);#EOL##EOL#&#x9;instance.setProcessLog(cmd1);#EOL##EOL#&#x9;var msg = session.executeProgram(cmd1);#EOL##EOL##EOL#&#x9;cmd1 = 'cscript speak.vbs .\\sound\\' + filename;#EOL##EOL#&#x9;instance.setProcessLog(cmd1);#EOL##EOL#&#x9;var msg = session.executeProgram(cmd1);#EOL##EOL#&#x9;if (msg != '' ) {#EOL#&#x9;&#x9;    showMessage(&quot;cmd1 実行しました&quot;);#EOL#&#x9;}#EOL##EOL#//&#x9;var msg = session.executeProgram('cmd /c cscript read.vbs ./sound/' + filename);#EOL##EOL#}#EOL##EOL#" SubsystemID="P" Type="XF000"/><Function ID="PF9997" Name="音声再生" Script="//////////////#EOL#// 変数定義 //#EOL#//////////////#EOL#var rＴ音声情報;#EOL#var key = session.getAttribute('PFormID');#EOL#// showMessage(key);#EOL#//////////////////////////////////////////////////////////////////#EOL#// 対象期間の売上実績(CT100)の読取と月次取引サマリ(YT010)の更新 //#EOL#//////////////////////////////////////////////////////////////////#EOL#rＴ音声情報 = instance.createTableOperator('Select', 'Ｔ音声情報');#EOL#rＴ音声情報.addKeyValue('ＩＤ', key);#EOL#var myPath = session.fileFolder;#EOL#while (rＴ音声情報.next()) {#EOL##EOL#&#x9;////////////////////////////////////////////#EOL#&#x9;// BREAKならば月次取引サマリ(YT010)の更新 //#EOL#&#x9;////////////////////////////////////////////#EOL#&#x9;var mess = rＴ音声情報.getValueOf('文章');#EOL#&#x9;var filename = rＴ音声情報.getValueOf('音声ファイル');#EOL##EOL#&#x9;var myPath = session.fileFolder;#EOL#&#x9;var awscliPath ='C:\\Program Files\\Amazon\\AWSCLI\\';#EOL##EOL#&#x9;var fname = myPath + &quot;\\data.txt&quot;;#EOL#&#x9;var str = mess;#EOL#&#x9;//&#x9;var charset = &quot;sjis&quot;;#EOL#&#x9;    var charset = &quot;utf8&quot;;#EOL#&#x9; #EOL#&#x9;cmd1 = 'cscript speak.vbs .\\sound\\' + filename;#EOL##EOL#&#x9;showMessage(cmd1);#EOL#&#x9;instance.setProcessLog(cmd1);#EOL##EOL#&#x9;var msg = session.executeProgram(cmd1);#EOL##EOL#&#x9;if (msg != '' ) {#EOL#//&#x9;&#x9;    showMessage(&quot;cmd1 実行しました&quot;);#EOL#&#x9;}#EOL##EOL#}#EOL##EOL#" SubsystemID="P" Type="XF000"/></System>